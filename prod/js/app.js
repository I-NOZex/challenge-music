"use strict";!function(){if("function"==typeof NodeList.prototype.forEach)return!1;NodeList.prototype.forEach=Array.prototype.forEach}();var api=new Vue({http:{root:"https://beat2revolution-api.herokuapp.com/api"}}),apiResources={users:"users",favorites:"users/:userId/musics",musics:"musics",musicDetails:"musics/:musicId"},User=new function(){return this.id=null,this.username=null,this.email=null,this.gravatar=null,this.isLogged=!1,this};User.login=function(t){var e=this;return new Promise(function(s,o){t||o("Enter an email address"),api.$http.get(apiResources.users).then(function(i){var r=i.body.find(function(e){return e.email===t});if(r){e.isLogged=!0,Object.keys(r).forEach(function(t){e[t]=r[t]});var n=MD5(r.email);e.gravatar="https://www.gravatar.com/avatar/"+n,s(e)}else o("No user matching provided email")},function(t){o("Request error: "+t.statusText)})})},User.logout=function(){if(!0!==User.isLogged)return!1;User.id=null,User.username=null,User.email=null,User.gravatar=null,User.isLogged=!1},User.getFavourites=function(){var t=this;return new Promise(function(e,s){!0!==User.isLogged&&s("Please login before"),api.$http.get(apiResources.favorites.replace(":userId",t.id)).then(function(t){e(t.body)},function(t){s("Request error: "+t.statusText)})})},User.isFavorite=function(t){var e=this;return new Promise(function(s,o){!0===e.isLogged?(""+e.musicId).length<1?o("Invalid music ID"):api.$http.get(apiResources.favorites.replace(":userId",e.id)).then(function(e){if(e.body){var i=e.body.find(function(e){return e.id===t});s(!!i)}else o("No favorites")},function(t){o("Request error: "+t.statusText)}):o("Please login before")})},User.addFavourite=function(t){var e=this;return new Promise(function(s,o){!0!==User.isLogged&&o("Please login before"),(""+User.musicId).length<1&&o("Invalid music ID"),api.$http.post(apiResources.favorites.replace(":userId",e.id),{musicid:t}).then(function(t){s(t.body)},function(t){o("Request error: "+t.statusText)})})},User.removeFavourite=function(t){var e=this;return new Promise(function(s,o){!0!==User.isLogged&&o("Please login before"),(""+User.musicId).length<1&&o("Invalid music ID"),api.$http.delete(apiResources.favorites.replace(":userId",e.id)+"/"+t).then(function(t){s(t.body)},function(t){o("Request error: "+t.statusText)})})},Vue.component("login-input",{template:"#tpl-login-input",data:function(){return{email:""}},methods:{login:function(t){this.$parent.User.login(t).then(function(t){app.$refs.curComponent.fetchFavs(!0)},function(t){app.showToast(t,"error")})}}}),Vue.component("login-link",{template:"#tpl-login-link",methods:{switchToInput:function(){this.$parent.switchToInput()}}}),Vue.component("toast-alert",{template:"#tpl-toast-alert",props:["toast"],methods:{switchToInput:function(){this.$parent.switchToInput()}}});var HomeComponent={template:"#tpl-tracklist",data:function(){return{tracks:null,favorites:null,fvs:[]}},created:function(){this.$parent.User.isLogged&&this.fetchFavs(!0),this.fetchData()},methods:{fetchData:function(){var t=this;api.$http.get(apiResources.musics).then(function(e){console.log("tracks loaded"),t.tracks=e.body},function(t){app.showToast("Error: Can't get musics list","error")})},fetchFavs:function(t){var e=this;e.$parent.User.getFavourites().then(function(s){console.log("favs loaded"),s.body&&(e.favorites=s.body,t&&(e.fvs=[],e.favorites.forEach(function(t){e.fvs.push(t.id)})))})},addToFavs:function(t){this.$parent.User.addFavourite(t).then(function(t){app.showToast(t.message,"success")},function(t){app.showToast("Error: A problem has occurred while adding to favorites","error")}),this.fvs.push(t),this.fetchFavs()},removeFromFavs:function(t){this.$parent.User.removeFavourite(t).then(function(t){app.showToast(t.message,"success")},function(t){app.showToast("Error: A problem has occurred while removing from favorites","error")}),this.fvs.splice(this.fvs.indexOf(t),1),this.fetchFavs()},isFavorite:function(t){var e=this;return e.favorites?e.favorites.find(function(e){if(e.id==t)return!0}):e.fetchFavs(!0)},activateCurrent:function(t){document.getElementById("tracks-container").childNodes.forEach(function(t){t.classList.remove("active")}),document.getElementById(t).classList.add("active")}},computed:{isUserLogged:function(){return this.$parent.User.isLogged}}},FavoritesComponent={template:"#tpl-tracklist",data:function(){return{tracks:null,fvs:[]}},created:function(){this.fetchData(!0)},methods:{fetchData:function(t){var e=this;e.$parent.User.getFavourites().then(function(s){s&&(e.tracks=s,t&&(e.fvs=[],e.tracks.forEach(function(t){e.fvs.push(t.id)})))},function(t){app.showToast("Error: Can't get favorits list","error")})},addToFavs:function(t){this.$parent.User.addFavourite(t).then(function(t){app.showToast(t.message,"success")},function(t){app.showToast(t,"error")}),this.fvs.push(t),this.fetchData()},removeFromFavs:function(t){this.$parent.User.removeFavourite(t).then(function(t){app.showToast(t.message,"success")},function(t){app.showToast("Error: A problem has occurred while removing from favorites","error")}),this.fvs.splice(this.fvs.indexOf(t),1),this.fetchData()},isFavorite:function(t){return!0},activateCurrent:function(t){document.getElementById("tracks-container").childNodes.forEach(function(t){t.classList.remove("active")}),document.getElementById(t).classList.add("active")}},computed:{isUserLogged:function(){return this.$parent.User.isLogged}}},TrackDetailsComponent={template:"#tpl-track-details",data:function(){return{trackdetails:{track:null,artist:null,album:null}}},created:function(){this.fetchData()},methods:{fetchData:function(){var t=this;api.$http.get(apiResources.musicDetails.replace(":musicId",t.$route.params.musicId)).then(function(e){t.trackdetails=e.body[0]},function(t){app.showToast("Error: Some error occurred while fetching music details","error")})}}},routes=[{path:"/",component:HomeComponent,name:"home",meta:{title:"Home"}},{path:"/users/:userId/musics",component:FavoritesComponent,name:"favorites",meta:{title:"Favorites"}},{path:"/musics/:musicId",component:TrackDetailsComponent,name:"music",meta:{title:"Music Detail"}}],router=new VueRouter({linkActiveClass:"active",routes:routes});router.beforeEach(function(t,e,s){User.isLogged||"favorites"!==t.name?(document.title="Beat2Revolution | "+t.meta.title,s()):s({path:"/",replace:!0})});var app=new Vue({router:router,data:{User:User,current:"login-link",toast:{msg:null,type:null},isToastActive:!1,isSideBarCollapsed:!0},methods:{switchToLink:function(){this.current="login-link"},switchToInput:function(){this.current="login-input"},showToast:function(t,e){var s=this;s.toast.msg=t,s.toast.type=e,s.isToastActive=!0,setTimeout(function(){s.isToastActive=!1},3500)},toggleCollapse:function(){this.isSideBarCollapsed=!this.isSideBarCollapsed}},components:["login-link","login-input","toast-alert"]}).$mount("#app");
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFwcC5qcyJdLCJuYW1lcyI6WyJOb2RlTGlzdCIsInByb3RvdHlwZSIsImZvckVhY2giLCJBcnJheSIsImFwaSIsIlZ1ZSIsImh0dHAiLCJyb290IiwiYXBpUmVzb3VyY2VzIiwidXNlcnMiLCJmYXZvcml0ZXMiLCJtdXNpY3MiLCJtdXNpY0RldGFpbHMiLCJVc2VyIiwidGhpcyIsImlkIiwidXNlcm5hbWUiLCJlbWFpbCIsImdyYXZhdGFyIiwiaXNMb2dnZWQiLCJsb2dpbiIsIl90aGlzIiwiUHJvbWlzZSIsInJlc29sdmUiLCJyZWplY3QiLCIkaHR0cCIsImdldCIsInRoZW4iLCJyZXNwb25zZSIsInVzZXJCeUVtYWlsIiwiYm9keSIsImZpbmQiLCJ1c2VyIiwiT2JqZWN0Iiwia2V5cyIsImZpZWxkIiwiZW1haWxIYXNoIiwiTUQ1Iiwic3RhdHVzVGV4dCIsImxvZ291dCIsImdldEZhdm91cml0ZXMiLCJyZXBsYWNlIiwiaXNGYXZvcml0ZSIsIm11c2ljSWQiLCJsZW5ndGgiLCJpc0ZhdiIsIm11c2ljIiwiYWRkRmF2b3VyaXRlIiwicG9zdCIsIm11c2ljaWQiLCJyZW1vdmVGYXZvdXJpdGUiLCJkZWxldGUiLCJjb21wb25lbnQiLCJ0ZW1wbGF0ZSIsImRhdGEiLCJtZXRob2RzIiwiJHBhcmVudCIsInJlc3VsdCIsImFwcCIsIiRyZWZzIiwiY3VyQ29tcG9uZW50IiwiZmV0Y2hGYXZzIiwic2hvd1RvYXN0Iiwic3dpdGNoVG9JbnB1dCIsInByb3BzIiwiSG9tZUNvbXBvbmVudCIsInRyYWNrcyIsImZ2cyIsImNyZWF0ZWQiLCJmZXRjaERhdGEiLCJjb25zb2xlIiwibG9nIiwiaXNDcmVhdGlvbiIsImZhdnMiLCJmIiwicHVzaCIsImFkZFRvRmF2cyIsIm1lc3NhZ2UiLCJyZW1vdmVGcm9tRmF2cyIsInNwbGljZSIsImluZGV4T2YiLCJmYXYiLCJhY3RpdmF0ZUN1cnJlbnQiLCJuZXdDdXJyZW50SWQiLCJkb2N1bWVudCIsImdldEVsZW1lbnRCeUlkIiwiY2hpbGROb2RlcyIsImNoaWxkIiwiY2xhc3NMaXN0IiwicmVtb3ZlIiwiYWRkIiwiY29tcHV0ZWQiLCJpc1VzZXJMb2dnZWQiLCJGYXZvcml0ZXNDb21wb25lbnQiLCJUcmFja0RldGFpbHNDb21wb25lbnQiLCJ0cmFja2RldGFpbHMiLCJ0cmFjayIsImFydGlzdCIsImFsYnVtIiwiJHJvdXRlIiwicGFyYW1zIiwicm91dGVzIiwicGF0aCIsIm5hbWUiLCJtZXRhIiwidGl0bGUiLCJyb3V0ZXIiLCJWdWVSb3V0ZXIiLCJsaW5rQWN0aXZlQ2xhc3MiLCJiZWZvcmVFYWNoIiwidG8iLCJmcm9tIiwibmV4dCIsImN1cnJlbnQiLCJ0b2FzdCIsIm1zZyIsInR5cGUiLCJpc1RvYXN0QWN0aXZlIiwiaXNTaWRlQmFyQ29sbGFwc2VkIiwic3dpdGNoVG9MaW5rIiwic2V0VGltZW91dCIsInRvZ2dsZUNvbGxhcHNlIiwiY29tcG9uZW50cyIsIiRtb3VudCJdLCJtYXBwaW5ncyI6IkFBQUEsY0FFQSxXQUNJLEdBQTJDLG1CQUEvQkEsU0FBU0MsVUFBVUMsUUFBeUIsT0FBTyxFQUMvREYsU0FBU0MsVUFBVUMsUUFBVUMsTUFBTUYsVUFBVUMsV0FHakQsSUFBSUUsSUFBTSxJQUFJQyxLQUNWQyxNQUNJQyxLQUFNLG1EQUlWQyxjQUNBQyxNQUFPLFFBRVBDLFVBQVcsdUJBQ1hDLE9BQVEsU0FDUkMsYUFBYyxtQkFHZEMsS0FBTyxJQUFJLFdBTVgsT0FMQUMsS0FBS0MsR0FBSyxLQUNWRCxLQUFLRSxTQUFXLEtBQ2hCRixLQUFLRyxNQUFRLEtBQ2JILEtBQUtJLFNBQVcsS0FDaEJKLEtBQUtLLFVBQVcsRUFDVEwsTUFHWEQsS0FBS08sTUFBUSxTQUFTSCxHQUNsQixJQUFJSSxFQUFRUCxLQUNaLE9BQU8sSUFBSVEsUUFBUSxTQUFTQyxFQUFTQyxHQUM1QlAsR0FBT08sRUFBTywwQkFDbkJwQixJQUFJcUIsTUFBTUMsSUFBSWxCLGFBQWFDLE9BQU9rQixLQUFLLFNBQWlCQyxHQUVwRCxJQUFJQyxFQUFjRCxFQUFTRSxL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QUFlc0MsS0FBTSxPQUFRQyxNQUFPQyxNQUFPLFVBQ2pFSCxLQUFNLHdCQUF5QmxELFVBQVd5QyxtQkFBb0JVLEtBQU0sWUFBYUMsTUFBT0MsTUFBTyxlQUMvRkgsS0FBTSxtQkFBb0JsRCxVQUFXMEMsc0JBQXVCUyxLQUFNLFFBQVNDLE1BQU9DLE1BQU8sa0JBTTNGQyxPQUFTLElBQUlDLFdBQ2JDLGdCQUFpQixTQUNqQlAsT0FBUUEsU0FHWkssT0FBT0csV0FBVyxTQUFTQyxFQUFJQyxFQUFNQyxHQUM3Qm5HLEtBQUtNLFVBQXdCLGNBQVoyRixFQUFHUCxNQUdwQm5CLFNBQVNxQixNQUFRLHFCQUFxQkssRUFBR04sS0FBS0MsTUFDOUNPLEtBSEFBLEdBQU9WLEtBQU0sSUFBSzdELFNBQVMsTUFXbkMsSUFBSWlCLElBQU0sSUFBSXJELEtBQ1ZxRyxPQUFPQSxPQUNQcEQsTUFDSXpDLEtBQU1BLEtBQ1RvRyxRQUFRLGFBQ0xDLE9BQVNDLElBQUksS0FBTUMsS0FBSyxNQUN4QkMsZUFBZSxFQUNmQyxvQkFBb0IsR0FHeEIvRCxTQUNDZ0UsYUFBYSxXQUNUekcsS0FBS21HLFFBQVUsY0FFaEJsRCxjQUFjLFdBQ2JqRCxLQUFLbUcsUUFBVSxlQUVoQm5ELFVBQVUsU0FBbUJxRCxFQUFLQyxHQUM5QixJQUFJL0YsRUFBUVAsS0FDZk8sRUFBTTZGLE1BQU1DLElBQU1BLEVBQ2xCOUYsRUFBTTZGLE1BQU1FLEtBQU9BLEVBQ2hCL0YsRUFBTWdHLGVBQWdCLEVBQ3RCRyxXQUFXLFdBQ1BuRyxFQUFNZ0csZUFBZ0IsR0FDeEIsT0FFTkksZUFBZ0IsV0FDWjNHLEtBQUt3RyxvQkFBc0J4RyxLQUFLd0cscUJBR3hDSSxZQUFZLGFBQWEsY0FBZSxpQkFDekNDLE9BQU8iLCJmaWxlIjoiYXBwLmpzIiwic291cmNlc0NvbnRlbnQiOlsiJ3VzZSBzdHJpY3QnO1xyXG5cclxuKGZ1bmN0aW9uICgpIHtcclxuICAgIGlmICggdHlwZW9mIE5vZGVMaXN0LnByb3RvdHlwZS5mb3JFYWNoID09PSBcImZ1bmN0aW9uXCIgKSByZXR1cm4gZmFsc2U7XHJcbiAgICBOb2RlTGlzdC5wcm90b3R5cGUuZm9yRWFjaCA9IEFycmF5LnByb3RvdHlwZS5mb3JFYWNoO1xyXG59KSgpO1xyXG5cclxudmFyIGFwaSA9IG5ldyBWdWUoe1xyXG4gICAgaHR0cDoge1xyXG4gICAgICAgIHJvb3Q6ICdodHRwczovL2JlYXQycmV2b2x1dGlvbi1hcGkuaGVyb2t1YXBwLmNvbS9hcGknLFxyXG4gICAgfVxyXG59KTtcclxuXHJcbnZhciBhcGlSZXNvdXJjZXMgPSB7XHJcbiAgICB1c2VyczogJ3VzZXJzJyxcclxuICAgIC8vbG9naW46ICd1c2Vycy86dXNlckVtYWlsJyxcclxuICAgIGZhdm9yaXRlczogJ3VzZXJzLzp1c2VySWQvbXVzaWNzJyxcclxuICAgIG11c2ljczogJ211c2ljcycsXHJcbiAgICBtdXNpY0RldGFpbHM6ICdtdXNpY3MvOm11c2ljSWQnXHJcbn1cclxuXHJcbnZhciBVc2VyID0gbmV3IGZ1bmN0aW9uKCl7XHJcbiAgICB0aGlzLmlkID0gbnVsbDtcclxuICAgIHRoaXMudXNlcm5hbWUgPSBudWxsO1xyXG4gICAgdGhpcy5lbWFpbCA9IG51bGw7XHJcbiAgICB0aGlzLmdyYXZhdGFyID0gbnVsbDtcclxuICAgIHRoaXMuaXNMb2dnZWQgPSBmYWxzZTtcclxuICAgIHJldHVybiB0aGlzO1xyXG59XHJcblxyXG5Vc2VyLmxvZ2luID0gZnVuY3Rpb24oZW1haWwpe1xyXG4gICAgdmFyIF90aGlzID0gdGhpcztcclxuICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbihyZXNvbHZlLCByZWplY3Qpe1xyXG4gICAgICAgIGlmICghZW1haWwpIHJlamVjdCgnRW50ZXIgYW4gZW1haWwgYWRkcmVzcycpO1xyXG4gICAgICAgIGFwaS4kaHR0cC5nZXQoYXBpUmVzb3VyY2VzLnVzZXJzKS50aGVuKGZ1bmN0aW9uIHN1Y2Nlc3MocmVzcG9uc2Upe1xyXG4gICAgICAgICAgICAvKiovXHJcbiAgICAgICAgICAgIHZhciB1c2VyQnlFbWFpbCA9IHJlc3BvbnNlLmJvZHkuZmluZChmdW5jdGlvbih1c2VyKXtcclxuICAgICAgICAgICAgICAgIHJldHVybiB1c2VyLmVtYWlsID09PSBlbWFpbDtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIGlmICghdXNlckJ5RW1haWwpe1xyXG4gICAgICAgICAgICAgICAgcmVqZWN0KCdObyB1c2VyIG1hdGNoaW5nIHByb3ZpZGVkIGVtYWlsJyk7XHJcbiAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgX3RoaXMuaXNMb2dnZWQgPSB0cnVlO1xyXG4gICAgICAgICAgICBPYmplY3Qua2V5cyh1c2VyQnlFbWFpbCkuZm9yRWFjaChmdW5jdGlvbihmaWVsZCl7XHJcbiAgICAgICAgICAgICAgICBfdGhpc1tmaWVsZF0gPSB1c2VyQnlFbWFpbFtmaWVsZF07XHJcbiAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgIHZhciBlbWFpbEhhc2ggPSBNRDUodXNlckJ5RW1haWwuZW1haWwpO1xyXG4gICAgICAgICAgICBfdGhpcy5ncmF2YXRhciA9IFwiaHR0cHM6Ly93d3cuZ3JhdmF0YXIuY29tL2F2YXRhci9cIiArIGVtYWlsSGFzaDtcclxuICAgICAgICAgICAgcmVzb2x2ZShfdGhpcyk7XHJcblxyXG4gICAgICAgIH0sIGZ1bmN0aW9uIGVycm9yKHJlc3BvbnNlKXtcclxuICAgICAgICAgICAgcmVqZWN0KCdSZXF1ZXN0IGVycm9yOiAnK3Jlc3BvbnNlLnN0YXR1c1RleHQpXHJcbiAgICAgICAgfSk7XHJcbiAgICB9KTtcclxufVxyXG5cclxuVXNlci5sb2dvdXQgPSBmdW5jdGlvbigpe1xyXG4gICAgaWYgKFVzZXIuaXNMb2dnZWQgIT09IHRydWUpIHJldHVybiBmYWxzZTtcclxuICAgIFVzZXIuaWQgPSBudWxsO1xyXG4gICAgVXNlci51c2VybmFtZSA9IG51bGw7XHJcbiAgICBVc2VyLmVtYWlsID0gbnVsbDtcclxuICAgIFVzZXIuZ3JhdmF0YXIgPSBudWxsXHJcbiAgICBVc2VyLmlzTG9nZ2VkID0gZmFsc2U7XHJcbn1cclxuXHJcblVzZXIuZ2V0RmF2b3VyaXRlcyA9IGZ1bmN0aW9uKCl7XHJcbiAgICB2YXIgX3RoaXMgPSB0aGlzO1xyXG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCl7XHJcbiAgICAgICAgaWYgKFVzZXIuaXNMb2dnZWQgIT09IHRydWUpIHJlamVjdChcIlBsZWFzZSBsb2dpbiBiZWZvcmVcIik7XHJcbiAgICAgICAgYXBpLiRodHRwLmdldChhcGlSZXNvdXJjZXMuZmF2b3JpdGVzLnJlcGxhY2UoXCI6dXNlcklkXCIsIF90aGlzLmlkKSkudGhlbihmdW5jdGlvbiBzdWNjZXNzKHJlc3BvbnNlKXtcclxuICAgICAgICAgICAgcmVzb2x2ZShyZXNwb25zZS5ib2R5KTtcclxuICAgICAgICB9LCBmdW5jdGlvbiBlcnJvcihyZXNwb25zZSl7XHJcbiAgICAgICAgICAgIHJlamVjdCgnUmVxdWVzdCBlcnJvcjogJytyZXNwb25zZS5zdGF0dXNUZXh0KVxyXG4gICAgICAgIH0pO1xyXG4gICAgfSk7XHJcbn1cclxuXHJcblVzZXIuaXNGYXZvcml0ZSA9IGZ1bmN0aW9uKG11c2ljSWQpe1xyXG4gICAgdmFyIF90aGlzID0gdGhpcztcclxuICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbihyZXNvbHZlLCByZWplY3Qpe1xyXG4gICAgICAgIGlmIChfdGhpcy5pc0xvZ2dlZCAhPT0gdHJ1ZSl7XHJcbiAgICAgICAgICAgIHJlamVjdChcIlBsZWFzZSBsb2dpbiBiZWZvcmVcIik7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKCgnJytfdGhpcy5tdXNpY0lkKS5sZW5ndGggPCAxKXtcclxuICAgICAgICAgICAgcmVqZWN0KFwiSW52YWxpZCBtdXNpYyBJRFwiKTtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgYXBpLiRodHRwLmdldChhcGlSZXNvdXJjZXMuZmF2b3JpdGVzLnJlcGxhY2UoXCI6dXNlcklkXCIsIF90aGlzLmlkKSkudGhlbihmdW5jdGlvbiBzdWNjZXNzKHJlc3BvbnNlKXtcclxuICAgICAgICAgICAgaWYoIXJlc3BvbnNlLmJvZHkpe1xyXG4gICAgICAgICAgICAgICAgcmVqZWN0KFwiTm8gZmF2b3JpdGVzXCIpO1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHZhciBpc0ZhdiA9IHJlc3BvbnNlLmJvZHkuZmluZChmdW5jdGlvbihtdXNpYyl7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gbXVzaWMuaWQgPT09IG11c2ljSWQ7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICByZXNvbHZlKCEhaXNGYXYpOyAvL2Nhc3QgdG8gYm9vbGVhblxyXG4gICAgICAgIH0sIGZ1bmN0aW9uIGVycm9yKHJlc3BvbnNlKXtcclxuICAgICAgICAgICAgcmVqZWN0KCdSZXF1ZXN0IGVycm9yOiAnK3Jlc3BvbnNlLnN0YXR1c1RleHQpXHJcbiAgICAgICAgfSk7XHJcbiAgICB9KTtcclxufVxyXG5cclxuVXNlci5hZGRGYXZvdXJpdGUgPSBmdW5jdGlvbihtdXNpY0lkKXtcclxuICAgIHZhciBfdGhpcyA9IHRoaXM7XHJcbiAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24ocmVzb2x2ZSwgcmVqZWN0KXsgICAgXHJcbiAgICAgICAgaWYgKFVzZXIuaXNMb2dnZWQgIT09IHRydWUpIHJlamVjdChcIlBsZWFzZSBsb2dpbiBiZWZvcmVcIik7XHJcbiAgICAgICAgaWYgKCgnJytVc2VyLm11c2ljSWQpLmxlbmd0aCA8IDEpIHJlamVjdChcIkludmFsaWQgbXVzaWMgSURcIik7XHJcbiAgICAgICAgYXBpLiRodHRwLnBvc3QoYXBpUmVzb3VyY2VzLmZhdm9yaXRlcy5yZXBsYWNlKFwiOnVzZXJJZFwiLCBfdGhpcy5pZCksIHtcIm11c2ljaWRcIjogbXVzaWNJZH0pLnRoZW4oZnVuY3Rpb24gc3VjY2VzcyhyZXNwb25zZSl7XHJcbiAgICAgICAgICAgIHJlc29sdmUocmVzcG9uc2UuYm9keSk7XHJcbiAgICAgICAgfSwgZnVuY3Rpb24gZXJyb3IocmVzcG9uc2Upe1xyXG4gICAgICAgICAgICByZWplY3QoJ1JlcXVlc3QgZXJyb3I6ICcrcmVzcG9uc2Uuc3RhdHVzVGV4dClcclxuICAgICAgICB9KTtcclxuICAgIH0pO1xyXG59XHJcblxyXG5Vc2VyLnJlbW92ZUZhdm91cml0ZSA9IGZ1bmN0aW9uKG11c2ljSWQpe1xyXG4gICAgdmFyIF90aGlzID0gdGhpcztcclxuICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbihyZXNvbHZlLCByZWplY3QpeyAgICBcclxuICAgICAgICBpZiAoVXNlci5pc0xvZ2dlZCAhPT0gdHJ1ZSkgcmVqZWN0KFwiUGxlYXNlIGxvZ2luIGJlZm9yZVwiKTtcclxuICAgICAgICBpZiAoKCcnK1VzZXIubXVzaWNJZCkubGVuZ3RoIDwgMSkgcmVqZWN0KFwiSW52YWxpZCBtdXNpYyBJRFwiKTtcclxuICAgICAgICBhcGkuJGh0dHAuZGVsZXRlKGFwaVJlc291cmNlcy5mYXZvcml0ZXMucmVwbGFjZShcIjp1c2VySWRcIiwgX3RoaXMuaWQpKycvJysgbXVzaWNJZCkudGhlbihmdW5jdGlvbiBzdWNjZXNzKHJlc3BvbnNlKXtcclxuICAgICAgICAgICAgcmVzb2x2ZShyZXNwb25zZS5ib2R5KTtcclxuICAgICAgICB9LCBmdW5jdGlvbiBlcnJvcihyZXNwb25zZSl7XHJcbiAgICAgICAgICAgIHJlamVjdCgnUmVxdWVzdCBlcnJvcjogJytyZXNwb25zZS5zdGF0dXNUZXh0KVxyXG4gICAgICAgIH0pO1xyXG4gICAgfSk7XHJcbn1cclxuXHJcblZ1ZS5jb21wb25lbnQoJ2xvZ2luLWlucHV0Jyx7XHJcbiAgICB0ZW1wbGF0ZTonI3RwbC1sb2dpbi1pbnB1dCcsXHJcbiAgICBkYXRhOiBmdW5jdGlvbigpeyByZXR1cm4geyBlbWFpbDogJyd9ICB9LFxyXG4gICAgbWV0aG9kczp7XHJcbiAgICAgICAgbG9naW46IGZ1bmN0aW9uKGVtYWlsKXtcclxuICAgICAgICAgICAgLyp2YXIgcmUgPSAvXFxTK0BcXFMrXFwuXFxTKy87XHJcbiAgICAgICAgICAgIGlmKCFyZS50ZXN0KGVtYWlsKSkgcmV0dXJuIGZhbHNlOyovXHJcbiAgICAgICAgICAgIHRoaXMuJHBhcmVudC5Vc2VyLmxvZ2luKGVtYWlsKS50aGVuKGZ1bmN0aW9uKHJlc3VsdCl7XHJcbiAgICAgICAgICAgICAgICBhcHAuJHJlZnMuY3VyQ29tcG9uZW50LmZldGNoRmF2cyh0cnVlKVxyXG4gICAgICAgICAgICB9LCBmdW5jdGlvbiBlcnJvcihyZXNwb25zZSl7XHJcbiAgICAgICAgICAgICAgICBhcHAuc2hvd1RvYXN0KHJlc3BvbnNlLCAnZXJyb3InKVxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcbiAgICB9LFxyXG59KVxyXG5cclxuVnVlLmNvbXBvbmVudCgnbG9naW4tbGluaycse1xyXG4gICAgdGVtcGxhdGU6JyN0cGwtbG9naW4tbGluaycsXHJcbiAgICBtZXRob2RzOntcclxuICAgICAgICBzd2l0Y2hUb0lucHV0OmZ1bmN0aW9uKCl7XHJcbiAgICAgICAgICAgIHRoaXMuJHBhcmVudC5zd2l0Y2hUb0lucHV0KCk7XHJcbiAgICAgICAgfVxyXG4gICAgfSxcclxufSlcclxuXHJcblZ1ZS5jb21wb25lbnQoJ3RvYXN0LWFsZXJ0Jyx7XHJcbiAgICB0ZW1wbGF0ZTonI3RwbC10b2FzdC1hbGVydCcsXHJcbiAgICBwcm9wczogWyd0b2FzdCddLFxyXG4gICAgLy9kYXRhOiBmdW5jdGlvbigpeyByZXR1cm4geyB0b2FzdDogeyB9ICB9IH0sXHJcbiAgICBtZXRob2RzOntcclxuICAgICAgICBzd2l0Y2hUb0lucHV0OmZ1bmN0aW9uKCl7XHJcbiAgICAgICAgICAgIHRoaXMuJHBhcmVudC5zd2l0Y2hUb0lucHV0KCk7XHJcbiAgICAgICAgfVxyXG4gICAgfSxcclxufSlcclxuLy8gMS4gRGVmaW5lIHJvdXRlIGNvbXBvbmVudHMuXHJcbi8vIFRoZXNlIGNhbiBiZSBpbXBvcnRlZCBmcm9tIG90aGVyIGZpbGVzXHJcbnZhciBIb21lQ29tcG9uZW50ID0ge1xyXG4gICAgdGVtcGxhdGU6ICcjdHBsLXRyYWNrbGlzdCcsXHJcbiAgICBkYXRhOiBmdW5jdGlvbigpeyByZXR1cm4ge3RyYWNrczogbnVsbCwgZmF2b3JpdGVzOiBudWxsLCBmdnM6IFtdfSB9LFxyXG4gICAgY3JlYXRlZDogZnVuY3Rpb24oKXtcclxuICAgICAgICAvLyBmZXRjaCB0aGUgZGF0YSB3aGVuIHRoZSB2aWV3IGlzIGNyZWF0ZWQgYW5kIHRoZSBkYXRhIGlzXHJcbiAgICAgICAgLy8gYWxyZWFkeSBiZWluZyBvYnNlcnZlZFxyXG4gICAgICAgIGlmKHRoaXMuJHBhcmVudC5Vc2VyLmlzTG9nZ2VkKVxyXG4gICAgICAgICAgICB0aGlzLmZldGNoRmF2cyh0cnVlKVxyXG5cclxuICAgICAgICB0aGlzLmZldGNoRGF0YSgpXHJcbiAgICB9LFxyXG4gICAgbWV0aG9kczoge1xyXG4gICAgICAgIGZldGNoRGF0YTogZnVuY3Rpb24oKXtcclxuICAgICAgICAgICAgdmFyIF90aGlzID0gdGhpcztcclxuICAgICAgICAgICAgYXBpLiRodHRwLmdldChhcGlSZXNvdXJjZXMubXVzaWNzKS50aGVuKGZ1bmN0aW9uIHN1Y2Nlc3ModHJhY2tzKXtcclxuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCd0cmFja3MgbG9hZGVkJyk7XHJcbiAgICAgICAgICAgICAgICBfdGhpcy50cmFja3MgPSB0cmFja3MuYm9keTtcclxuICAgICAgICAgICAgfSwgZnVuY3Rpb24gZXJyb3IocmVzcG9uc2Upe1xyXG4gICAgICAgICAgICAgICAgYXBwLnNob3dUb2FzdChcIkVycm9yOiBDYW4ndCBnZXQgbXVzaWNzIGxpc3RcIiwgJ2Vycm9yJylcclxuICAgICAgICAgICAgfSlcclxuXHJcblxyXG4gICAgICAgIH0sXHJcbiAgICAgICAgZmV0Y2hGYXZzOiBmdW5jdGlvbihpc0NyZWF0aW9uKXtcclxuICAgICAgICAgICAgdmFyIF90aGlzID0gdGhpcztcclxuICAgICAgICAgICAgX3RoaXMuJHBhcmVudC5Vc2VyLmdldEZhdm91cml0ZXMoKS50aGVuKGZ1bmN0aW9uIHN1Y2Nlc3MoZmF2cyl7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ2ZhdnMgbG9hZGVkJyk7XHJcbiAgICAgICAgICAgICAgICBpZighZmF2cy5ib2R5KSByZXR1cm47XHJcblxyXG4gICAgICAgICAgICAgICAgX3RoaXMuZmF2b3JpdGVzID0gZmF2cy5ib2R5O1xyXG5cclxuICAgICAgICAgICAgICAgIGlmKGlzQ3JlYXRpb24pe1xyXG4gICAgICAgICAgICAgICAgICAgIF90aGlzLmZ2cyA9IFtdO1xyXG4gICAgICAgICAgICAgICAgICAgIF90aGlzLmZhdm9yaXRlcy5mb3JFYWNoKGZ1bmN0aW9uKGYpe1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBfdGhpcy5mdnMucHVzaChmLmlkKVxyXG4gICAgICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH0sXHJcbiAgICAgICAgYWRkVG9GYXZzOiBmdW5jdGlvbihtdXNpY0lkKXtcclxuICAgICAgICAgICAgdGhpcy4kcGFyZW50LlVzZXIuYWRkRmF2b3VyaXRlKG11c2ljSWQpLnRoZW4oZnVuY3Rpb24gc3VjY2VzcyhyZXNwb25zZSl7XHJcbiAgICAgICAgICAgICAgICBhcHAuc2hvd1RvYXN0KHJlc3BvbnNlLm1lc3NhZ2UsICdzdWNjZXNzJylcclxuICAgICAgICAgICAgfSwgZnVuY3Rpb24gZXJyb3IocmVzcG9uc2Upe1xyXG4gICAgICAgICAgICAgICAgYXBwLnNob3dUb2FzdChcIkVycm9yOiBBIHByb2JsZW0gaGFzIG9jY3VycmVkIHdoaWxlIGFkZGluZyB0byBmYXZvcml0ZXNcIiwgJ2Vycm9yJylcclxuICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgdGhpcy5mdnMucHVzaChtdXNpY0lkKVxyXG4gICAgICAgICAgICB0aGlzLmZldGNoRmF2cygpXHJcbiAgICAgICAgICAgIC8vdGhpcy5mZXRjaERhdGEoKVxyXG4gICAgICAgIH0sXHJcbiAgICAgICAgcmVtb3ZlRnJvbUZhdnM6IGZ1bmN0aW9uKG11c2ljSWQpe1xyXG4gICAgICAgICAgICB0aGlzLiRwYXJlbnQuVXNlci5yZW1vdmVGYXZvdXJpdGUobXVzaWNJZCkudGhlbihmdW5jdGlvbiBzdWNjZXNzKHJlc3BvbnNlKXtcclxuICAgICAgICAgICAgICAgIGFwcC5zaG93VG9hc3QocmVzcG9uc2UubWVzc2FnZSwgJ3N1Y2Nlc3MnKVxyXG4gICAgICAgICAgICB9LCBmdW5jdGlvbiBlcnJvcihyZXNwb25zZSl7XHJcbiAgICAgICAgICAgICAgICBhcHAuc2hvd1RvYXN0KFwiRXJyb3I6IEEgcHJvYmxlbSBoYXMgb2NjdXJyZWQgd2hpbGUgcmVtb3ZpbmcgZnJvbSBmYXZvcml0ZXNcIiwgJ2Vycm9yJylcclxuICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgdGhpcy5mdnMuc3BsaWNlKHRoaXMuZnZzLmluZGV4T2YobXVzaWNJZCksIDEpXHJcbiAgICAgICAgICAgIHRoaXMuZmV0Y2hGYXZzKClcclxuICAgICAgICB9LFxyXG4gICAgICAgIGlzRmF2b3JpdGU6IGZ1bmN0aW9uKG11c2ljSWQpe1xyXG4gICAgICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xyXG4gICAgICAgICAgICBpZighX3RoaXMuZmF2b3JpdGVzKSByZXR1cm4gX3RoaXMuZmV0Y2hGYXZzKHRydWUpO1xyXG5cclxuICAgICAgICAgICAgdmFyIGlzRmF2ID0gX3RoaXMuZmF2b3JpdGVzLmZpbmQoZnVuY3Rpb24oZmF2KXtcclxuICAgICAgICAgICAgICAgIGlmKGZhdi5pZCA9PSBtdXNpY0lkKSByZXR1cm4gdHJ1ZTtcclxuICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGlzRmF2O1xyXG5cclxuICAgICAgICB9LFxyXG4gICAgICAgIGFjdGl2YXRlQ3VycmVudDogZnVuY3Rpb24obmV3Q3VycmVudElkKXtcclxuICAgICAgICAgICAgdmFyIGNoaWxkcyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd0cmFja3MtY29udGFpbmVyJyk7XHJcbiAgICAgICAgICAgIGNoaWxkcy5jaGlsZE5vZGVzLmZvckVhY2goZnVuY3Rpb24oY2hpbGQpe1xyXG4gICAgICAgICAgICAgICAgY2hpbGQuY2xhc3NMaXN0LnJlbW92ZSgnYWN0aXZlJyk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB2YXIgbmV3Q3VycmVudCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKG5ld0N1cnJlbnRJZCk7XHJcbiAgICAgICAgICAgIG5ld0N1cnJlbnQuY2xhc3NMaXN0LmFkZCgnYWN0aXZlJyk7ICAgICAgXHJcbiAgICAgICAgfSAgIFxyXG4gICAgfSxcclxuICAgIGNvbXB1dGVkOiB7XHJcbiAgICAgICAgaXNVc2VyTG9nZ2VkOiBmdW5jdGlvbigpe1xyXG4gICAgICAgICAgICByZXR1cm4gdGhpcy4kcGFyZW50LlVzZXIuaXNMb2dnZWQ7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG59XHJcblxyXG52YXIgRmF2b3JpdGVzQ29tcG9uZW50ID0ge1xyXG4gICAgdGVtcGxhdGU6ICcjdHBsLXRyYWNrbGlzdCcsXHJcbiAgICBkYXRhOiBmdW5jdGlvbigpeyByZXR1cm4ge3RyYWNrczogbnVsbCwgZnZzOltdfSB9LFxyXG4gICAgY3JlYXRlZDogZnVuY3Rpb24oKXtcclxuICAgICAgICAvLyBmZXRjaCB0aGUgZGF0YSB3aGVuIHRoZSB2aWV3IGlzIGNyZWF0ZWQgYW5kIHRoZSBkYXRhIGlzXHJcbiAgICAgICAgLy8gYWxyZWFkeSBiZWluZyBvYnNlcnZlZFxyXG4gICAgICAgIHRoaXMuZmV0Y2hEYXRhKHRydWUpXHJcbiAgICB9LFxyXG4gICAgbWV0aG9kczoge1xyXG4gICAgICAgIGZldGNoRGF0YTogZnVuY3Rpb24oaXNDcmVhdGlvbil7XHJcbiAgICAgICAgICAgIHZhciBfdGhpcyA9IHRoaXM7XHJcbiAgICAgICAgICAgIF90aGlzLiRwYXJlbnQuVXNlci5nZXRGYXZvdXJpdGVzKCkudGhlbihmdW5jdGlvbiBzdWNjZXNzKHJlc3BvbnNlKXtcclxuICAgICAgICAgICAgICAgIGlmKCFyZXNwb25zZSkgcmV0dXJuO1xyXG4gICAgICAgICAgICAgICAgX3RoaXMudHJhY2tzID0gcmVzcG9uc2U7XHJcbiAgICAgICAgICAgICAgICBpZihpc0NyZWF0aW9uKXtcclxuICAgICAgICAgICAgICAgICAgICBfdGhpcy5mdnMgPSBbXTtcclxuICAgICAgICAgICAgICAgICAgICBfdGhpcy50cmFja3MuZm9yRWFjaChmdW5jdGlvbihmKXtcclxuICAgICAgICAgICAgICAgICAgICAgICAgX3RoaXMuZnZzLnB1c2goZi5pZClcclxuICAgICAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9LCBmdW5jdGlvbiBlcnJvcihyZXNwb25zZSl7XHJcbiAgICAgICAgICAgICAgICAvL1RPRE86IGhhbmRsZSBlcnJvclxyXG4gICAgICAgICAgICAgICAgYXBwLnNob3dUb2FzdChcIkVycm9yOiBDYW4ndCBnZXQgZmF2b3JpdHMgbGlzdFwiLCAnZXJyb3InKVxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9LFxyXG4gICAgICAgIGFkZFRvRmF2czogZnVuY3Rpb24obXVzaWNJZCl7XHJcbiAgICAgICAgICAgIHRoaXMuJHBhcmVudC5Vc2VyLmFkZEZhdm91cml0ZShtdXNpY0lkKS50aGVuKGZ1bmN0aW9uIHN1Y2Nlc3MocmVzcG9uc2Upe1xyXG4gICAgICAgICAgICAgICAgYXBwLnNob3dUb2FzdChyZXNwb25zZS5tZXNzYWdlLCAnc3VjY2VzcycpXHJcbiAgICAgICAgICAgIH0sIGZ1bmN0aW9uIGVycm9yKHJlc3BvbnNlKXtcclxuICAgICAgICAgICAgICAgIGFwcC5zaG93VG9hc3QocmVzcG9uc2UsICdlcnJvcicpXHJcbiAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgIHRoaXMuZnZzLnB1c2gobXVzaWNJZClcclxuICAgICAgICAgICAgdGhpcy5mZXRjaERhdGEoKVxyXG4gICAgICAgICAgICAvL3RoaXMuZmV0Y2hEYXRhKClcclxuICAgICAgICB9LFxyXG4gICAgICAgIHJlbW92ZUZyb21GYXZzOiBmdW5jdGlvbihtdXNpY0lkKXtcclxuICAgICAgICAgICAgdGhpcy4kcGFyZW50LlVzZXIucmVtb3ZlRmF2b3VyaXRlKG11c2ljSWQpLnRoZW4oZnVuY3Rpb24gc3VjY2VzcyhyZXNwb25zZSl7XHJcbiAgICAgICAgICAgICAgICBhcHAuc2hvd1RvYXN0KHJlc3BvbnNlLm1lc3NhZ2UsICdzdWNjZXNzJylcclxuICAgICAgICAgICAgfSwgZnVuY3Rpb24gZXJyb3IocmVzcG9uc2Upe1xyXG4gICAgICAgICAgICAgICAgYXBwLnNob3dUb2FzdChcIkVycm9yOiBBIHByb2JsZW0gaGFzIG9jY3VycmVkIHdoaWxlIHJlbW92aW5nIGZyb20gZmF2b3JpdGVzXCIsICdlcnJvcicpXHJcbiAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgIHRoaXMuZnZzLnNwbGljZSh0aGlzLmZ2cy5pbmRleE9mKG11c2ljSWQpLCAxKVxyXG4gICAgICAgICAgICB0aGlzLmZldGNoRGF0YSgpXHJcbiAgICAgICAgfSxcclxuICAgICAgICBpc0Zhdm9yaXRlOiBmdW5jdGlvbihtdXNpY0lkKXtcclxuICAgICAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICAgICAgfSxcclxuICAgICAgICBhY3RpdmF0ZUN1cnJlbnQ6IGZ1bmN0aW9uKG5ld0N1cnJlbnRJZCl7XHJcbiAgICAgICAgICAgIHZhciBjaGlsZHMgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgndHJhY2tzLWNvbnRhaW5lcicpO1xyXG4gICAgICAgICAgICBjaGlsZHMuY2hpbGROb2Rlcy5mb3JFYWNoKGZ1bmN0aW9uKGNoaWxkKXtcclxuICAgICAgICAgICAgICAgIGNoaWxkLmNsYXNzTGlzdC5yZW1vdmUoJ2FjdGl2ZScpO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgdmFyIG5ld0N1cnJlbnQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChuZXdDdXJyZW50SWQpO1xyXG4gICAgICAgICAgICBuZXdDdXJyZW50LmNsYXNzTGlzdC5hZGQoJ2FjdGl2ZScpOyAgICAgIFxyXG4gICAgICAgIH0gXHJcbiAgICB9LFxyXG4gICAgY29tcHV0ZWQ6IHtcclxuICAgICAgICBpc1VzZXJMb2dnZWQ6IGZ1bmN0aW9uKCl7XHJcbiAgICAgICAgICAgIHJldHVybiB0aGlzLiRwYXJlbnQuVXNlci5pc0xvZ2dlZDtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbn1cclxuXHJcbnZhciBUcmFja0RldGFpbHNDb21wb25lbnQgPSB7XHJcbiAgICB0ZW1wbGF0ZTogJyN0cGwtdHJhY2stZGV0YWlscycsXHJcbiAgICBkYXRhOiBmdW5jdGlvbigpeyByZXR1cm4ge3RyYWNrZGV0YWlsczoge3RyYWNrOm51bGwsIGFydGlzdDogbnVsbCwgYWxidW06IG51bGx9fSB9LFxyXG4gICAgY3JlYXRlZDogZnVuY3Rpb24oKXtcclxuICAgICAgICAvLyBmZXRjaCB0aGUgZGF0YSB3aGVuIHRoZSB2aWV3IGlzIGNyZWF0ZWQgYW5kIHRoZSBkYXRhIGlzXHJcbiAgICAgICAgLy8gYWxyZWFkeSBiZWluZyBvYnNlcnZlZFxyXG4gICAgICAgIHRoaXMuZmV0Y2hEYXRhKClcclxuICAgIH0sXHJcbiAgICBtZXRob2RzOiB7XHJcbiAgICAgICAgZmV0Y2hEYXRhOiBmdW5jdGlvbigpe1xyXG4gICAgICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xyXG4gICAgICAgICAgICBhcGkuJGh0dHAuZ2V0KGFwaVJlc291cmNlcy5tdXNpY0RldGFpbHMucmVwbGFjZShcIjptdXNpY0lkXCIsIF90aGlzLiRyb3V0ZS5wYXJhbXMubXVzaWNJZCkpLnRoZW4oZnVuY3Rpb24gc3VjY2VzcyhyZXNwb25zZSl7XHJcbiAgICAgICAgICAgICAgICBfdGhpcy50cmFja2RldGFpbHMgPSByZXNwb25zZS5ib2R5WzBdO1xyXG4gICAgICAgICAgICB9LCBmdW5jdGlvbiBlcnJvcihyZXNwb25zZSl7XHJcbiAgICAgICAgICAgICAgICAvL1RPRE86IGhhbmRsZSBlcnJvclxyXG4gICAgICAgICAgICAgICAgYXBwLnNob3dUb2FzdChcIkVycm9yOiBTb21lIGVycm9yIG9jY3VycmVkIHdoaWxlIGZldGNoaW5nIG11c2ljIGRldGFpbHNcIiwgJ2Vycm9yJylcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG59XHJcblxyXG5cclxuLy8gMi4gRGVmaW5lIHNvbWUgcm91dGVzXHJcbi8vIEVhY2ggcm91dGUgc2hvdWxkIG1hcCB0byBhIGNvbXBvbmVudC4gVGhlIFwiY29tcG9uZW50XCIgY2FuXHJcbi8vIGVpdGhlciBiZSBhbiBhY3R1YWwgY29tcG9uZW50IGNvbnN0cnVjdG9yIGNyZWF0ZWQgdmlhXHJcbi8vIFZ1ZS5leHRlbmQoKSwgb3IganVzdCBhIGNvbXBvbmVudCBvcHRpb25zIG9iamVjdC5cclxuLy8gV2UnbGwgdGFsayBhYm91dCBuZXN0ZWQgcm91dGVzIGxhdGVyLlxyXG52YXIgcm91dGVzID0gW1xyXG4gICAgeyBwYXRoOiAnLycsIGNvbXBvbmVudDogSG9tZUNvbXBvbmVudCwgbmFtZTogJ2hvbWUnLCBtZXRhOiB7dGl0bGU6ICdIb21lJ30gfSxcclxuICAgIHsgcGF0aDogJy91c2Vycy86dXNlcklkL211c2ljcycsIGNvbXBvbmVudDogRmF2b3JpdGVzQ29tcG9uZW50LCBuYW1lOiAnZmF2b3JpdGVzJywgbWV0YToge3RpdGxlOiAnRmF2b3JpdGVzJ30gfSxcclxuICAgIHsgcGF0aDogJy9tdXNpY3MvOm11c2ljSWQnLCBjb21wb25lbnQ6IFRyYWNrRGV0YWlsc0NvbXBvbmVudCwgbmFtZTogJ211c2ljJywgbWV0YToge3RpdGxlOiAnTXVzaWMgRGV0YWlsJ30gfVxyXG5dXHJcblxyXG4vLyAzLiBDcmVhdGUgdGhlIHJvdXRlciBpbnN0YW5jZSBhbmQgcGFzcyB0aGUgYHJvdXRlc2Agb3B0aW9uXHJcbi8vIFlvdSBjYW4gcGFzcyBpbiBhZGRpdGlvbmFsIG9wdGlvbnMgaGVyZSwgYnV0IGxldCdzXHJcbi8vIGtlZXAgaXQgc2ltcGxlIGZvciBub3cuXHJcbnZhciByb3V0ZXIgPSBuZXcgVnVlUm91dGVyKHtcclxuICAgIGxpbmtBY3RpdmVDbGFzczogJ2FjdGl2ZScsXHJcbiAgICByb3V0ZXM6IHJvdXRlc1xyXG59KVxyXG5cclxucm91dGVyLmJlZm9yZUVhY2goZnVuY3Rpb24odG8sIGZyb20sIG5leHQpIHtcclxuICAgIGlmKCFVc2VyLmlzTG9nZ2VkICYmIHRvLm5hbWUgPT09ICdmYXZvcml0ZXMnKXtcclxuICAgICAgICBuZXh0KHsgcGF0aDogJy8nLCByZXBsYWNlOiB0cnVlfSlcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgICAgZG9jdW1lbnQudGl0bGUgPSBcIkJlYXQyUmV2b2x1dGlvbiB8IFwiK3RvLm1ldGEudGl0bGVcclxuICAgICAgICBuZXh0KClcclxuICAgIH1cclxufSlcclxuXHJcblxyXG4vLyA0LiBDcmVhdGUgYW5kIG1vdW50IHRoZSByb290IGluc3RhbmNlLlxyXG4vLyBNYWtlIHN1cmUgdG8gaW5qZWN0IHRoZSByb3V0ZXIgd2l0aCB0aGUgcm91dGVyIG9wdGlvbiB0byBtYWtlIHRoZVxyXG4vLyB3aG9sZSBhcHAgcm91dGVyLWF3YXJlLlxyXG52YXIgYXBwID0gbmV3IFZ1ZSh7XHJcbiAgICByb3V0ZXI6cm91dGVyLFxyXG4gICAgZGF0YToge1xyXG4gICAgICAgIFVzZXI6IFVzZXIsXHJcbiAgICBcdGN1cnJlbnQ6XCJsb2dpbi1saW5rXCIsXHJcbiAgICAgICAgdG9hc3Q6IHsgbXNnOm51bGwsIHR5cGU6bnVsbCB9LFxyXG4gICAgICAgIGlzVG9hc3RBY3RpdmU6IGZhbHNlLFxyXG4gICAgICAgIGlzU2lkZUJhckNvbGxhcHNlZDogdHJ1ZVxyXG4gICAgICAgIC8vc3dpdGNoVG9JbnB1dDogZnVuY3Rpb24oKXtjb25zb2xlLmxvZygnYmxhJyl9IC8vdGhpcy5zd2l0Y2hUb0lucHV0XHJcbiAgICB9LFxyXG4gICAgbWV0aG9kczp7XHJcbiAgICBcdHN3aXRjaFRvTGluazpmdW5jdGlvbigpe1xyXG4gICAgICAgIFx0dGhpcy5jdXJyZW50ID0gJ2xvZ2luLWxpbmsnO1xyXG4gICAgICAgIH0sXHJcbiAgICAgICAgc3dpdGNoVG9JbnB1dDpmdW5jdGlvbiBzd2l0Y2hUb0lucHV0KCl7XHJcbiAgICAgICAgXHR0aGlzLmN1cnJlbnQgPSAnbG9naW4taW5wdXQnXHJcbiAgICAgICAgfSxcclxuICAgICAgICBzaG93VG9hc3Q6ZnVuY3Rpb24gc2hvd1RvYXN0KG1zZywgdHlwZSl7XHJcbiAgICAgICAgICAgIHZhciBfdGhpcyA9IHRoaXM7XHJcbiAgICAgICAgXHRfdGhpcy50b2FzdC5tc2cgPSBtc2c7XHJcbiAgICAgICAgXHRfdGhpcy50b2FzdC50eXBlID0gdHlwZTtcclxuICAgICAgICAgICAgX3RoaXMuaXNUb2FzdEFjdGl2ZSA9IHRydWU7XHJcbiAgICAgICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24oKXtcclxuICAgICAgICAgICAgICAgIF90aGlzLmlzVG9hc3RBY3RpdmUgPSBmYWxzZTtcclxuICAgICAgICAgICAgfSwzNTAwKVxyXG4gICAgICAgIH0sICBcclxuICAgICAgICB0b2dnbGVDb2xsYXBzZTogZnVuY3Rpb24oKXtcclxuICAgICAgICAgICAgdGhpcy5pc1NpZGVCYXJDb2xsYXBzZWQgPSAhdGhpcy5pc1NpZGVCYXJDb2xsYXBzZWQ7XHJcbiAgICAgICAgfSAgICAgICAgICBcclxuICAgIH0sXHJcbiAgICBjb21wb25lbnRzOlsnbG9naW4tbGluaycsJ2xvZ2luLWlucHV0JywgJ3RvYXN0LWFsZXJ0J10sXHJcbn0pLiRtb3VudCgnI2FwcCcpXHJcbiJdfQ==
