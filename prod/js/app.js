"use strict";!function(){if("function"==typeof NodeList.prototype.forEach)return!1;NodeList.prototype.forEach=Array.prototype.forEach}();var api=new Vue({http:{root:"https://beat2revolution-api.herokuapp.com/api"}}),apiResources={users:"users",favorites:"users/:userId/musics",musics:"musics",musicDetails:"musics/:musicId"},User=new function(){return this.id=null,this.username=null,this.email=null,this.gravatar=null,this.isLogged=!1,this};User.login=function(t){var e=this;return new Promise(function(i,s){t||s("Enter an email address"),api.$http.get(apiResources.users).then(function(n){var o=n.body.find(function(e){return e.email===t});if(o){e.isLogged=!0,Object.keys(o).forEach(function(t){e[t]=o[t]});var r=MD5(o.email);e.gravatar="https://www.gravatar.com/avatar/"+r,i(e)}else s("No user matching provided email")},function(t){s("Request error: "+t.statusText)})})},User.logout=function(){if(!0!==User.isLogged)return!1;User.id=null,User.username=null,User.email=null,User.gravatar=null,User.isLogged=!1},User.getFavourites=function(){var t=this;return new Promise(function(e,i){!0!==User.isLogged&&i("Please login before"),api.$http.get(apiResources.favorites.replace(":userId",t.id)).then(function(t){e(t.body)},function(t){i("Request error: "+t.statusText)})})},User.isFavorite=function(t){var e=this;return new Promise(function(i,s){!0===e.isLogged?(""+e.musicId).length<1?s("Invalid music ID"):api.$http.get(apiResources.favorites.replace(":userId",e.id)).then(function(e){if(e.body){var n=e.body.find(function(e){return e.id===t});i(!!n)}else s("No favorites")},function(t){s("Request error: "+t.statusText)}):s("Please login before")})},User.addFavourite=function(t){var e=this;return new Promise(function(i,s){!0!==User.isLogged&&s("Please login before"),(""+User.musicId).length<1&&s("Invalid music ID"),api.$http.post(apiResources.favorites.replace(":userId",e.id),{musicid:t}).then(function(t){i(t.body)},function(t){s("Request error: "+t.statusText)})})},User.removeFavourite=function(t){var e=this;return new Promise(function(i,s){!0!==User.isLogged&&s("Please login before"),(""+User.musicId).length<1&&s("Invalid music ID"),api.$http.delete(apiResources.favorites.replace(":userId",e.id)+"/"+t).then(function(t){i(t.body)},function(t){s("Request error: "+t.statusText)})})},Vue.component("login-input",{template:"#tpl-login-input",data:function(){return{email:""}},methods:{login:function(t){this.$parent.User.login(t).then(function(t){app.$refs.curComponent.fetchFavs(!0)},function(t){app.showToast(t,"error")})}}}),Vue.component("login-link",{template:"#tpl-login-link",methods:{switchToInput:function(){this.$parent.switchToInput()}}}),Vue.component("toast-alert",{template:"#tpl-toast-alert",props:["toast"],methods:{switchToInput:function(){this.$parent.switchToInput()}}});var playerData={player:{engine:new Audio,isPlaying:!1,elapsedTime:"00:00",elapsedPercent:0},file:{src:"https://s3.amazonaws.com/pb_previews/205_clap-tap/205_full_clap-tap_0102.mp3",duration:"102",musicArtist:"Brightside Studio",musicName:"Clap Tap",musicCover:"http://hw-img.datpiff.com/mb799428/Deion_Music_Birth-front.jpg"}};Vue.component("media-player",{template:"#tpl-media-player",data:function(){return playerData},created:function(){this.addListeners()},mounted:function(){fixContentHeight()},methods:{addListeners:function(){this.player.engine.addEventListener("timeupdate",this.timeUpdated,!1)},play:function(){this.player.isPlaying?(this.player.engine.pause(),this.player.isPlaying=!1):(this.player.engine.src=this.file.src,this.player.engine.play(),this.player.isPlaying=!0)},marqueeAnimate:function(t){var e=t.target,i=e.classList;i.contains("animate")||(i.add("animate"),e.parentNode.classList.add("animate"),window.addEventListener(animationEndEvent(),function(){i.remove("animate"),e.parentNode.classList.remove("animate")}))},timeUpdated:function(){var t=Math.round(this.player.engine.currentTime),e=Math.floor(t/60<<0),i=Math.floor(t%60);this.player.elapsedTime=(e<10?"0"+e:e)+":"+(i<10?"0"+i:i),this.player.elapsedPercent=100*t/this.file.duration+"%"}},computed:{totalTime:function(){var t=this.file.duration,e=Math.floor(t/60<<0),i=Math.floor(t%60);return(e<10?"0"+e:e)+":"+(i<10?"0"+i:i)}}});var HomeComponent={template:"#tpl-tracklist",data:function(){return{tracks:null,favorites:null,fvs:[]}},created:function(){this.$parent.User.isLogged&&this.fetchFavs(!0),this.fetchData()},methods:{fetchData:function(){var t=this;api.$http.get(apiResources.musics).then(function(e){console.log("tracks loaded"),t.tracks=e.body},function(t){app.showToast("Error: Can't get musics list","error")})},fetchFavs:function(t){var e=this;e.$parent.User.getFavourites().then(function(i){console.log("favs loaded"),i&&(e.favorites=i,t&&(e.fvs=[],e.favorites.forEach(function(t){e.fvs.push(t.id)})))})},addToFavs:function(t){this.$parent.User.addFavourite(t).then(function(t){app.showToast(t.message,"success")},function(t){app.showToast("Error: A problem has occurred while adding to favorites","error")}),this.fvs.push(t),this.fetchFavs()},removeFromFavs:function(t){this.$parent.User.removeFavourite(t).then(function(t){app.showToast(t.message,"success")},function(t){app.showToast("Error: A problem has occurred while removing from favorites","error")}),this.fvs.splice(this.fvs.indexOf(t),1),this.fetchFavs()},isFavorite:function(t){var e=this;return e.favorites?e.favorites.find(function(e){if(e.id==t)return!0}):e.fetchFavs(!0)}},computed:{isUserLogged:function(){return this.$parent.User.isLogged}}},FavoritesComponent={template:"#tpl-tracklist",data:function(){return{tracks:null,fvs:[]}},created:function(){this.fetchData(!0)},methods:{fetchData:function(t){var e=this;e.$parent.User.getFavourites().then(function(i){i&&(e.tracks=i,t&&(e.fvs=[],e.tracks.forEach(function(t){e.fvs.push(t.id)})))},function(t){app.showToast("Error: Can't get favorits list","error")})},addToFavs:function(t){this.$parent.User.addFavourite(t).then(function(t){app.showToast(t.message,"success")},function(t){app.showToast(t,"error")}),this.fvs.push(t),this.fetchData()},removeFromFavs:function(t){this.$parent.User.removeFavourite(t).then(function(t){app.showToast(t.message,"success")},function(t){app.showToast("Error: A problem has occurred while removing from favorites","error")}),this.fvs.splice(this.fvs.indexOf(t),1),this.fetchData()},isFavorite:function(t){return!0}},computed:{isUserLogged:function(){return this.$parent.User.isLogged}}},TrackDetailsComponent={template:"#tpl-track-details",data:function(){return{trackdetails:{track:null,artist:null,album:null}}},created:function(){this.fetchData()},methods:{fetchData:function(){var t=this;api.$http.get(apiResources.musicDetails.replace(":musicId",t.$route.params.musicId)).then(function(e){t.trackdetails=e.body[0]},function(t){app.showToast("Error: Some error occurred while fetching music details","error")})}}},routes=[{path:"/",component:HomeComponent,name:"home",meta:{title:"Home"}},{path:"/users/:userId/musics",component:FavoritesComponent,name:"favorites",meta:{title:"Favorites"}},{path:"/musics/:musicId",component:TrackDetailsComponent,name:"music",meta:{title:"Music Detail"}}],router=new VueRouter({linkActiveClass:"active",routes:routes});router.beforeEach(function(t,e,i){User.isLogged||"favorites"!==t.name?(document.title="Beat2Revolution | "+t.meta.title,i()):i({path:"/",replace:!0})});var app=new Vue({router:router,data:{User:User,current:"login-link",toast:{msg:null,type:null},isToastActive:!1,isSideBarCollapsed:!0},methods:{switchToLink:function(){this.current="login-link"},switchToInput:function(){this.current="login-input"},showToast:function(t,e){var i=this;i.toast.msg=t,i.toast.type=e,i.isToastActive=!0,setTimeout(function(){i.isToastActive=!1},3500)},toggleCollapse:function(){this.isSideBarCollapsed=!this.isSideBarCollapsed}},components:["login-link","login-input","toast-alert","media-player"]}).$mount("#app");
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFwcC5qcyJdLCJuYW1lcyI6WyJOb2RlTGlzdCIsInByb3RvdHlwZSIsImZvckVhY2giLCJBcnJheSIsImFwaSIsIlZ1ZSIsImh0dHAiLCJyb290IiwiYXBpUmVzb3VyY2VzIiwidXNlcnMiLCJmYXZvcml0ZXMiLCJtdXNpY3MiLCJtdXNpY0RldGFpbHMiLCJVc2VyIiwidGhpcyIsImlkIiwidXNlcm5hbWUiLCJlbWFpbCIsImdyYXZhdGFyIiwiaXNMb2dnZWQiLCJsb2dpbiIsIl90aGlzIiwiUHJvbWlzZSIsInJlc29sdmUiLCJyZWplY3QiLCIkaHR0cCIsImdldCIsInRoZW4iLCJyZXNwb25zZSIsInVzZXJCeUVtYWlsIiwiYm9keSIsImZpbmQiLCJ1c2VyIiwiT2JqZWN0Iiwia2V5cyIsImZpZWxkIiwiZW1haWxIYXNoIiwiTUQ1Iiwic3RhdHVzVGV4dCIsImxvZ291dCIsImdldEZhdm91cml0ZXMiLCJyZXBsYWNlIiwiaXNGYXZvcml0ZSIsIm11c2ljSWQiLCJsZW5ndGgiLCJpc0ZhdiIsIm11c2ljIiwiYWRkRmF2b3VyaXRlIiwicG9zdCIsIm11c2ljaWQiLCJyZW1vdmVGYXZvdXJpdGUiLCJkZWxldGUiLCJjb21wb25lbnQiLCJ0ZW1wbGF0ZSIsImRhdGEiLCJtZXRob2RzIiwiJHBhcmVudCIsInJlc3VsdCIsImFwcCIsIiRyZWZzIiwiY3VyQ29tcG9uZW50IiwiZmV0Y2hGYXZzIiwic2hvd1RvYXN0Iiwic3dpdGNoVG9JbnB1dCIsInByb3BzIiwicGxheWVyRGF0YSIsInBsYXllciIsImVuZ2luZSIsIkF1ZGlvIiwiaXNQbGF5aW5nIiwiZWxhcHNlZFRpbWUiLCJlbGFwc2VkUGVyY2VudCIsImZpbGUiLCJzcmMiLCJkdXJhdGlvbiIsIm11c2ljQXJ0aXN0IiwibXVzaWNOYW1lIiwibXVzaWNDb3ZlciIsImNyZWF0ZWQiLCJhZGRMaXN0ZW5lcnMiLCJtb3VudGVkIiwiZml4Q29udGVudEhlaWdodCIsImFkZEV2ZW50TGlzdGVuZXIiLCJ0aW1lVXBkYXRlZCIsInBsYXkiLCJwYXVzZSIsIm1hcnF1ZWVBbmltYXRlIiwiZSIsInN0cmluZ1RvQW5pbWF0ZSIsInRhcmdldCIsImNsYXNzZXMiLCJjbGFzc0xpc3QiLCJjb250YWlucyIsImFkZCIsInBhcmVudE5vZGUiLCJ3aW5kb3ciLCJhbmltYXRpb25FbmRFdmVudCIsInJlbW92ZSIsInNlY29uZHMiLCJNYXRoIiwicm91bmQiLCJjdXJyZW50VGltZSIsIm1pbiIsImZsb29yIiwic2VjIiwiY29tcHV0ZWQiLCJ0b3RhbFRpbWUiLCJIb21lQ29tcG9uZW50IiwidHJhY2tzIiwiZnZzIiwiZmV0Y2hEYXRhIiwiY29uc29sZSIsImxvZyIsImlzQ3JlYXRpb24iLCJmYXZzIiwiZiIsInB1c2giLCJhZGRUb0ZhdnMiLCJtZXNzYWdlIiwicmVtb3ZlRnJvbUZhdnMiLCJzcGxpY2UiLCJpbmRleE9mIiwiZmF2IiwiaXNVc2VyTG9nZ2VkIiwiRmF2b3JpdGVzQ29tcG9uZW50IiwiVHJhY2tEZXRhaWxzQ29tcG9uZW50IiwidHJhY2tkZXRhaWxzIiwidHJhY2siLCJhcnRpc3QiLCJhbGJ1bSIsIiRyb3V0ZSIsInBhcmFtcyIsInJvdXRlcyIsInBhdGgiLCJuYW1lIiwibWV0YSIsInRpdGxlIiwicm91dGVyIiwiVnVlUm91dGVyIiwibGlua0FjdGl2ZUNsYXNzIiwiYmVmb3JlRWFjaCIsInRvIiwiZnJvbSIsIm5leHQiLCJkb2N1bWVudCIsImN1cnJlbnQiLCJ0b2FzdCIsIm1zZyIsInR5cGUiLCJpc1RvYXN0QWN0aXZlIiwiaXNTaWRlQmFyQ29sbGFwc2VkIiwic3dpdGNoVG9MaW5rIiwic2V0VGltZW91dCIsInRvZ2dsZUNvbGxhcHNlIiwiY29tcG9uZW50cyIsIiRtb3VudCJdLCJtYXBwaW5ncyI6IkFBQUEsY0FFQSxXQUNJLEdBQTJDLG1CQUEvQkEsU0FBU0MsVUFBVUMsUUFBeUIsT0FBTyxFQUMvREYsU0FBU0MsVUFBVUMsUUFBVUMsTUFBTUYsVUFBVUMsV0FHakQsSUFBSUUsSUFBTSxJQUFJQyxLQUNWQyxN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S0MsR0FDOUIsSUFBSS9ILEVBQVFQLEtBQ2ZPLEVBQU02SCxNQUFNQyxJQUFNQSxFQUNsQjlILEVBQU02SCxNQUFNRSxLQUFPQSxFQUNoQi9ILEVBQU1nSSxlQUFnQixFQUN0QkcsV0FBVyxXQUNQbkksRUFBTWdJLGVBQWdCLEdBQ3hCLE9BRU5JLGVBQWdCLFdBQ1ozSSxLQUFLd0ksb0JBQXNCeEksS0FBS3dJLHFCQUd4Q0ksWUFBWSxhQUFhLGNBQWUsY0FBZSxrQkFDeERDLE9BQU8iLCJmaWxlIjoiYXBwLmpzIiwic291cmNlc0NvbnRlbnQiOlsiJ3VzZSBzdHJpY3QnO1xyXG5cclxuKGZ1bmN0aW9uICgpIHtcclxuICAgIGlmICggdHlwZW9mIE5vZGVMaXN0LnByb3RvdHlwZS5mb3JFYWNoID09PSBcImZ1bmN0aW9uXCIgKSByZXR1cm4gZmFsc2U7XHJcbiAgICBOb2RlTGlzdC5wcm90b3R5cGUuZm9yRWFjaCA9IEFycmF5LnByb3RvdHlwZS5mb3JFYWNoO1xyXG59KSgpO1xyXG5cclxudmFyIGFwaSA9IG5ldyBWdWUoe1xyXG4gICAgaHR0cDoge1xyXG4gICAgICAgIHJvb3Q6IC8vJ2h0dHA6Ly9sb2NhbGhvc3Q6ODA4MC9hcGknLFxyXG4gICAgICAgICdodHRwczovL2JlYXQycmV2b2x1dGlvbi1hcGkuaGVyb2t1YXBwLmNvbS9hcGknLFxyXG4gICAgfVxyXG59KTtcclxuXHJcbnZhciBhcGlSZXNvdXJjZXMgPSB7XHJcbiAgICB1c2VyczogJ3VzZXJzJyxcclxuICAgIC8vbG9naW46ICd1c2Vycy86dXNlckVtYWlsJyxcclxuICAgIGZhdm9yaXRlczogJ3VzZXJzLzp1c2VySWQvbXVzaWNzJyxcclxuICAgIG11c2ljczogJ211c2ljcycsXHJcbiAgICBtdXNpY0RldGFpbHM6ICdtdXNpY3MvOm11c2ljSWQnXHJcbn1cclxuXHJcbnZhciBVc2VyID0gbmV3IGZ1bmN0aW9uKCl7XHJcbiAgICB0aGlzLmlkID0gbnVsbDtcclxuICAgIHRoaXMudXNlcm5hbWUgPSBudWxsO1xyXG4gICAgdGhpcy5lbWFpbCA9IG51bGw7XHJcbiAgICB0aGlzLmdyYXZhdGFyID0gbnVsbDtcclxuICAgIHRoaXMuaXNMb2dnZWQgPSBmYWxzZTtcclxuICAgIHJldHVybiB0aGlzO1xyXG59XHJcblxyXG5Vc2VyLmxvZ2luID0gZnVuY3Rpb24oZW1haWwpe1xyXG4gICAgdmFyIF90aGlzID0gdGhpcztcclxuICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbihyZXNvbHZlLCByZWplY3Qpe1xyXG4gICAgICAgIGlmICghZW1haWwpIHJlamVjdCgnRW50ZXIgYW4gZW1haWwgYWRkcmVzcycpO1xyXG4gICAgICAgIGFwaS4kaHR0cC5nZXQoYXBpUmVzb3VyY2VzLnVzZXJzKS50aGVuKGZ1bmN0aW9uIHN1Y2Nlc3MocmVzcG9uc2Upe1xyXG4gICAgICAgICAgICAvKiovXHJcbiAgICAgICAgICAgIHZhciB1c2VyQnlFbWFpbCA9IHJlc3BvbnNlLmJvZHkuZmluZChmdW5jdGlvbih1c2VyKXtcclxuICAgICAgICAgICAgICAgIHJldHVybiB1c2VyLmVtYWlsID09PSBlbWFpbDtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIGlmICghdXNlckJ5RW1haWwpe1xyXG4gICAgICAgICAgICAgICAgcmVqZWN0KCdObyB1c2VyIG1hdGNoaW5nIHByb3ZpZGVkIGVtYWlsJyk7XHJcbiAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgX3RoaXMuaXNMb2dnZWQgPSB0cnVlO1xyXG4gICAgICAgICAgICBPYmplY3Qua2V5cyh1c2VyQnlFbWFpbCkuZm9yRWFjaChmdW5jdGlvbihmaWVsZCl7XHJcbiAgICAgICAgICAgICAgICBfdGhpc1tmaWVsZF0gPSB1c2VyQnlFbWFpbFtmaWVsZF07XHJcbiAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgIHZhciBlbWFpbEhhc2ggPSBNRDUodXNlckJ5RW1haWwuZW1haWwpO1xyXG4gICAgICAgICAgICBfdGhpcy5ncmF2YXRhciA9IFwiaHR0cHM6Ly93d3cuZ3JhdmF0YXIuY29tL2F2YXRhci9cIiArIGVtYWlsSGFzaDtcclxuICAgICAgICAgICAgcmVzb2x2ZShfdGhpcyk7XHJcblxyXG4gICAgICAgIH0sIGZ1bmN0aW9uIGVycm9yKHJlc3BvbnNlKXtcclxuICAgICAgICAgICAgcmVqZWN0KCdSZXF1ZXN0IGVycm9yOiAnK3Jlc3BvbnNlLnN0YXR1c1RleHQpXHJcbiAgICAgICAgfSk7XHJcbiAgICB9KTtcclxufVxyXG5cclxuVXNlci5sb2dvdXQgPSBmdW5jdGlvbigpe1xyXG4gICAgaWYgKFVzZXIuaXNMb2dnZWQgIT09IHRydWUpIHJldHVybiBmYWxzZTtcclxuICAgIFVzZXIuaWQgPSBudWxsO1xyXG4gICAgVXNlci51c2VybmFtZSA9IG51bGw7XHJcbiAgICBVc2VyLmVtYWlsID0gbnVsbDtcclxuICAgIFVzZXIuZ3JhdmF0YXIgPSBudWxsXHJcbiAgICBVc2VyLmlzTG9nZ2VkID0gZmFsc2U7XHJcbn1cclxuXHJcblVzZXIuZ2V0RmF2b3VyaXRlcyA9IGZ1bmN0aW9uKCl7XHJcbiAgICB2YXIgX3RoaXMgPSB0aGlzO1xyXG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCl7XHJcbiAgICAgICAgaWYgKFVzZXIuaXNMb2dnZWQgIT09IHRydWUpIHJlamVjdChcIlBsZWFzZSBsb2dpbiBiZWZvcmVcIik7XHJcbiAgICAgICAgYXBpLiRodHRwLmdldChhcGlSZXNvdXJjZXMuZmF2b3JpdGVzLnJlcGxhY2UoXCI6dXNlcklkXCIsIF90aGlzLmlkKSkudGhlbihmdW5jdGlvbiBzdWNjZXNzKHJlc3BvbnNlKXtcclxuICAgICAgICAgICAgcmVzb2x2ZShyZXNwb25zZS5ib2R5KTtcclxuICAgICAgICB9LCBmdW5jdGlvbiBlcnJvcihyZXNwb25zZSl7XHJcbiAgICAgICAgICAgIHJlamVjdCgnUmVxdWVzdCBlcnJvcjogJytyZXNwb25zZS5zdGF0dXNUZXh0KVxyXG4gICAgICAgIH0pO1xyXG4gICAgfSk7XHJcbn1cclxuXHJcblVzZXIuaXNGYXZvcml0ZSA9IGZ1bmN0aW9uKG11c2ljSWQpe1xyXG4gICAgdmFyIF90aGlzID0gdGhpcztcclxuICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbihyZXNvbHZlLCByZWplY3Qpe1xyXG4gICAgICAgIGlmIChfdGhpcy5pc0xvZ2dlZCAhPT0gdHJ1ZSl7XHJcbiAgICAgICAgICAgIHJlamVjdChcIlBsZWFzZSBsb2dpbiBiZWZvcmVcIik7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKCgnJytfdGhpcy5tdXNpY0lkKS5sZW5ndGggPCAxKXtcclxuICAgICAgICAgICAgcmVqZWN0KFwiSW52YWxpZCBtdXNpYyBJRFwiKTtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgYXBpLiRodHRwLmdldChhcGlSZXNvdXJjZXMuZmF2b3JpdGVzLnJlcGxhY2UoXCI6dXNlcklkXCIsIF90aGlzLmlkKSkudGhlbihmdW5jdGlvbiBzdWNjZXNzKHJlc3BvbnNlKXtcclxuICAgICAgICAgICAgaWYoIXJlc3BvbnNlLmJvZHkpe1xyXG4gICAgICAgICAgICAgICAgcmVqZWN0KFwiTm8gZmF2b3JpdGVzXCIpO1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHZhciBpc0ZhdiA9IHJlc3BvbnNlLmJvZHkuZmluZChmdW5jdGlvbihtdXNpYyl7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gbXVzaWMuaWQgPT09IG11c2ljSWQ7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICByZXNvbHZlKCEhaXNGYXYpOyAvL2Nhc3QgdG8gYm9vbGVhblxyXG4gICAgICAgIH0sIGZ1bmN0aW9uIGVycm9yKHJlc3BvbnNlKXtcclxuICAgICAgICAgICAgcmVqZWN0KCdSZXF1ZXN0IGVycm9yOiAnK3Jlc3BvbnNlLnN0YXR1c1RleHQpXHJcbiAgICAgICAgfSk7XHJcbiAgICB9KTtcclxufVxyXG5cclxuVXNlci5hZGRGYXZvdXJpdGUgPSBmdW5jdGlvbihtdXNpY0lkKXtcclxuICAgIHZhciBfdGhpcyA9IHRoaXM7XHJcbiAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24ocmVzb2x2ZSwgcmVqZWN0KXsgICAgXHJcbiAgICAgICAgaWYgKFVzZXIuaXNMb2dnZWQgIT09IHRydWUpIHJlamVjdChcIlBsZWFzZSBsb2dpbiBiZWZvcmVcIik7XHJcbiAgICAgICAgaWYgKCgnJytVc2VyLm11c2ljSWQpLmxlbmd0aCA8IDEpIHJlamVjdChcIkludmFsaWQgbXVzaWMgSURcIik7XHJcbiAgICAgICAgYXBpLiRodHRwLnBvc3QoYXBpUmVzb3VyY2VzLmZhdm9yaXRlcy5yZXBsYWNlKFwiOnVzZXJJZFwiLCBfdGhpcy5pZCksIHtcIm11c2ljaWRcIjogbXVzaWNJZH0pLnRoZW4oZnVuY3Rpb24gc3VjY2VzcyhyZXNwb25zZSl7XHJcbiAgICAgICAgICAgIHJlc29sdmUocmVzcG9uc2UuYm9keSk7XHJcbiAgICAgICAgfSwgZnVuY3Rpb24gZXJyb3IocmVzcG9uc2Upe1xyXG4gICAgICAgICAgICByZWplY3QoJ1JlcXVlc3QgZXJyb3I6ICcrcmVzcG9uc2Uuc3RhdHVzVGV4dClcclxuICAgICAgICB9KTtcclxuICAgIH0pO1xyXG59XHJcblxyXG5Vc2VyLnJlbW92ZUZhdm91cml0ZSA9IGZ1bmN0aW9uKG11c2ljSWQpe1xyXG4gICAgdmFyIF90aGlzID0gdGhpcztcclxuICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbihyZXNvbHZlLCByZWplY3QpeyAgICBcclxuICAgICAgICBpZiAoVXNlci5pc0xvZ2dlZCAhPT0gdHJ1ZSkgcmVqZWN0KFwiUGxlYXNlIGxvZ2luIGJlZm9yZVwiKTtcclxuICAgICAgICBpZiAoKCcnK1VzZXIubXVzaWNJZCkubGVuZ3RoIDwgMSkgcmVqZWN0KFwiSW52YWxpZCBtdXNpYyBJRFwiKTtcclxuICAgICAgICBhcGkuJGh0dHAuZGVsZXRlKGFwaVJlc291cmNlcy5mYXZvcml0ZXMucmVwbGFjZShcIjp1c2VySWRcIiwgX3RoaXMuaWQpKycvJysgbXVzaWNJZCkudGhlbihmdW5jdGlvbiBzdWNjZXNzKHJlc3BvbnNlKXtcclxuICAgICAgICAgICAgcmVzb2x2ZShyZXNwb25zZS5ib2R5KTtcclxuICAgICAgICB9LCBmdW5jdGlvbiBlcnJvcihyZXNwb25zZSl7XHJcbiAgICAgICAgICAgIHJlamVjdCgnUmVxdWVzdCBlcnJvcjogJytyZXNwb25zZS5zdGF0dXNUZXh0KVxyXG4gICAgICAgIH0pO1xyXG4gICAgfSk7XHJcbn1cclxuXHJcblZ1ZS5jb21wb25lbnQoJ2xvZ2luLWlucHV0Jyx7XHJcbiAgICB0ZW1wbGF0ZTonI3RwbC1sb2dpbi1pbnB1dCcsXHJcbiAgICBkYXRhOiBmdW5jdGlvbigpeyByZXR1cm4geyBlbWFpbDogJyd9ICB9LFxyXG4gICAgbWV0aG9kczp7XHJcbiAgICAgICAgbG9naW46IGZ1bmN0aW9uKGVtYWlsKXtcclxuICAgICAgICAgICAgLyp2YXIgcmUgPSAvXFxTK0BcXFMrXFwuXFxTKy87XHJcbiAgICAgICAgICAgIGlmKCFyZS50ZXN0KGVtYWlsKSkgcmV0dXJuIGZhbHNlOyovXHJcbiAgICAgICAgICAgIHRoaXMuJHBhcmVudC5Vc2VyLmxvZ2luKGVtYWlsKS50aGVuKGZ1bmN0aW9uKHJlc3VsdCl7XHJcbiAgICAgICAgICAgICAgICBhcHAuJHJlZnMuY3VyQ29tcG9uZW50LmZldGNoRmF2cyh0cnVlKVxyXG4gICAgICAgICAgICB9LCBmdW5jdGlvbiBlcnJvcihyZXNwb25zZSl7XHJcbiAgICAgICAgICAgICAgICBhcHAuc2hvd1RvYXN0KHJlc3BvbnNlLCAnZXJyb3InKVxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcbiAgICB9LFxyXG59KVxyXG5cclxuVnVlLmNvbXBvbmVudCgnbG9naW4tbGluaycse1xyXG4gICAgdGVtcGxhdGU6JyN0cGwtbG9naW4tbGluaycsXHJcbiAgICBtZXRob2RzOntcclxuICAgICAgICBzd2l0Y2hUb0lucHV0OmZ1bmN0aW9uKCl7XHJcbiAgICAgICAgICAgIHRoaXMuJHBhcmVudC5zd2l0Y2hUb0lucHV0KCk7XHJcbiAgICAgICAgfVxyXG4gICAgfSxcclxufSlcclxuXHJcblZ1ZS5jb21wb25lbnQoJ3RvYXN0LWFsZXJ0Jyx7XHJcbiAgICB0ZW1wbGF0ZTonI3RwbC10b2FzdC1hbGVydCcsXHJcbiAgICBwcm9wczogWyd0b2FzdCddLFxyXG4gICAgLy9kYXRhOiBmdW5jdGlvbigpeyByZXR1cm4geyB0b2FzdDogeyB9ICB9IH0sXHJcbiAgICBtZXRob2RzOntcclxuICAgICAgICBzd2l0Y2hUb0lucHV0OmZ1bmN0aW9uKCl7XHJcbiAgICAgICAgICAgIHRoaXMuJHBhcmVudC5zd2l0Y2hUb0lucHV0KCk7XHJcbiAgICAgICAgfVxyXG4gICAgfSxcclxufSlcclxuXHJcbnZhciBwbGF5ZXJEYXRhID0ge1xyXG4gICAgcGxheWVyOiB7XHJcbiAgICAgICAgZW5naW5lOiBuZXcgQXVkaW8oKSxcclxuICAgICAgICBpc1BsYXlpbmc6IGZhbHNlLFxyXG4gICAgICAgIGVsYXBzZWRUaW1lOiAnMDA6MDAnLFxyXG4gICAgICAgIGVsYXBzZWRQZXJjZW50OiAwXHJcbiAgICB9LFxyXG4gICAgZmlsZToge1xyXG4gICAgICAgIHNyYzogJ2h0dHBzOi8vczMuYW1hem9uYXdzLmNvbS9wYl9wcmV2aWV3cy8yMDVfY2xhcC10YXAvMjA1X2Z1bGxfY2xhcC10YXBfMDEwMi5tcDMnLFxyXG4gICAgICAgIGR1cmF0aW9uOiAnMTAyJywgLy9zZWNvbmRzXHJcbiAgICAgICAgbXVzaWNBcnRpc3Q6ICdCcmlnaHRzaWRlIFN0dWRpbycsXHJcbiAgICAgICAgbXVzaWNOYW1lOiAnQ2xhcCBUYXAnLFxyXG4gICAgICAgIG11c2ljQ292ZXI6ICdodHRwOi8vaHctaW1nLmRhdHBpZmYuY29tL21iNzk5NDI4L0RlaW9uX011c2ljX0JpcnRoLWZyb250LmpwZycsXHJcbiAgICB9XHJcbn1cclxuVnVlLmNvbXBvbmVudCgnbWVkaWEtcGxheWVyJyx7XHJcbiAgICB0ZW1wbGF0ZTogJyN0cGwtbWVkaWEtcGxheWVyJyxcclxuICAgIGRhdGE6IGZ1bmN0aW9uKCl7IHJldHVybiBwbGF5ZXJEYXRhIH0sXHJcbiAgICBjcmVhdGVkOiBmdW5jdGlvbigpe1xyXG4gICAgICAgIC8vIGZldGNoIHRoZSBkYXRhIHdoZW4gdGhlIHZpZXcgaXMgY3JlYXRlZCBhbmQgdGhlIGRhdGEgaXNcclxuICAgICAgICAvLyBhbHJlYWR5IGJlaW5nIG9ic2VydmVkXHJcbiAgICAgICAgLy9maXhDb250ZW50SGVpZ2h0KCk7XHJcbiAgICAgICAgdGhpcy5hZGRMaXN0ZW5lcnMoKTtcclxuICAgIH0sXHJcbiAgICBtb3VudGVkOiBmdW5jdGlvbigpIHtcclxuICAgICAgICBmaXhDb250ZW50SGVpZ2h0KCk7XHJcbiAgICB9LCAgICBcclxuICAgIG1ldGhvZHM6IHtcclxuICAgICAgICBhZGRMaXN0ZW5lcnM6IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICB0aGlzLnBsYXllci5lbmdpbmUuYWRkRXZlbnRMaXN0ZW5lcigndGltZXVwZGF0ZScsdGhpcy50aW1lVXBkYXRlZCxmYWxzZSk7XHJcbiAgICAgICAgfSwgICAgICAgIFxyXG4gICAgICAgIHBsYXk6IGZ1bmN0aW9uKCl7XHJcbiAgICAgICAgICAgIGlmKHRoaXMucGxheWVyLmlzUGxheWluZyl7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnBsYXllci5lbmdpbmUucGF1c2UoKTtcclxuICAgICAgICAgICAgICAgIHRoaXMucGxheWVyLmlzUGxheWluZyA9IGZhbHNlO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5wbGF5ZXIuZW5naW5lLnNyYyA9IHRoaXMuZmlsZS5zcmM7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnBsYXllci5lbmdpbmUucGxheSgpO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5wbGF5ZXIuaXNQbGF5aW5nID0gdHJ1ZTsgXHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgfSxcclxuICAgICAgICBtYXJxdWVlQW5pbWF0ZTogZnVuY3Rpb24oZSl7XHJcbiAgICAgICAgICAgIHZhciBzdHJpbmdUb0FuaW1hdGUgPSBlLnRhcmdldDtcclxuICAgICAgICAgICAgdmFyIGNsYXNzZXMgPSBzdHJpbmdUb0FuaW1hdGUuY2xhc3NMaXN0O1xyXG4gICAgICAgICAgICBpZihjbGFzc2VzLmNvbnRhaW5zKCdhbmltYXRlJykpIHJldHVybjtcclxuICAgICAgICAgICAgY2xhc3Nlcy5hZGQoJ2FuaW1hdGUnKTtcclxuICAgICAgICAgICAgc3RyaW5nVG9BbmltYXRlLnBhcmVudE5vZGUuY2xhc3NMaXN0LmFkZCgnYW5pbWF0ZScpXHJcblxyXG4gICAgICAgICAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcihhbmltYXRpb25FbmRFdmVudCgpLCBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgICAgIGNsYXNzZXMucmVtb3ZlKCdhbmltYXRlJyk7XHJcbiAgICAgICAgICAgICAgICBzdHJpbmdUb0FuaW1hdGUucGFyZW50Tm9kZS5jbGFzc0xpc3QucmVtb3ZlKCdhbmltYXRlJykgICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICBcclxuICAgICAgICB9LFxyXG4gICAgICAgIHRpbWVVcGRhdGVkOiBmdW5jdGlvbigpe1xyXG4gICAgICAgICAgICB2YXIgc2Vjb25kcyA9IE1hdGgucm91bmQodGhpcy5wbGF5ZXIuZW5naW5lLmN1cnJlbnRUaW1lKSxcclxuICAgICAgICAgICAgbWluID0gTWF0aC5mbG9vcigoc2Vjb25kcyAvNjApIDw8IDApLFxyXG4gICAgICAgICAgICBzZWMgPSBNYXRoLmZsb29yKChzZWNvbmRzICkgJSA2MCk7XHJcbiAgICAgICAgICAgIHRoaXMucGxheWVyLmVsYXBzZWRUaW1lICA9IChtaW48MTA/JzAnK21pbjptaW4pICsgJzonICsgKHNlYzwxMD8nMCcrc2VjOnNlYyk7XHJcbiAgICAgICAgICAgIHRoaXMucGxheWVyLmVsYXBzZWRQZXJjZW50ID0gKChzZWNvbmRzICogMTAwKSAgLyB0aGlzLmZpbGUuZHVyYXRpb24pKyclJztcclxuICAgICAgICB9IFxyXG4gICAgfSwgY29tcHV0ZWQ6IHtcclxuICAgICAgIC8qIGVsYXBzZWRUaW1lOiBmdW5jdGlvbigpe1xyXG4gICAgICAgICAgICB2YXIgc2Vjb25kcyA9IE1hdGgucm91bmQodGhpcy5wbGF5ZXIuZW5naW5lLmN1cnJlbnRUaW1lKSxcclxuICAgICAgICAgICAgbWluID0gTWF0aC5mbG9vcigoc2Vjb25kcyAvNjApIDw8IDApLFxyXG4gICAgICAgICAgICBzZWMgPSBNYXRoLmZsb29yKChzZWNvbmRzICkgJSA2MCk7XHJcbiAgICAgICAgICAgIHJldHVybiAobWluPDEwPycwJyttaW46bWluKSArICc6JyArIChzZWM8MTA/JzAnK3NlYzpzZWMpO1xyXG4gICAgICAgIH0sKi9cclxuICAgICAgICB0b3RhbFRpbWU6IGZ1bmN0aW9uKCl7XHJcbiAgICAgICAgICAgIHZhciBzZWNvbmRzID0gdGhpcy5maWxlLmR1cmF0aW9uLFxyXG4gICAgICAgICAgICBtaW4gPSBNYXRoLmZsb29yKChzZWNvbmRzIC82MCkgPDwgMCksXHJcbiAgICAgICAgICAgIHNlYyA9IE1hdGguZmxvb3IoKHNlY29uZHMgKSAlIDYwKTtcclxuICAgICAgICAgICAgcmV0dXJuIChtaW48MTA/JzAnK21pbjptaW4pICsgJzonICsgKHNlYzwxMD8nMCcrc2VjOnNlYyk7XHJcbiAgICAgICAgfSAgICAgICAgXHJcbiAgICB9XHJcbn0pO1xyXG5cclxuLy8gMS4gRGVmaW5lIHJvdXRlIGNvbXBvbmVudHMuXHJcbi8vIFRoZXNlIGNhbiBiZSBpbXBvcnRlZCBmcm9tIG90aGVyIGZpbGVzXHJcbnZhciBIb21lQ29tcG9uZW50ID0ge1xyXG4gICAgdGVtcGxhdGU6ICcjdHBsLXRyYWNrbGlzdCcsXHJcbiAgICBkYXRhOiBmdW5jdGlvbigpeyByZXR1cm4ge3RyYWNrczogbnVsbCwgZmF2b3JpdGVzOiBudWxsLCBmdnM6IFtdfSB9LFxyXG4gICAgY3JlYXRlZDogZnVuY3Rpb24oKXtcclxuICAgICAgICAvLyBmZXRjaCB0aGUgZGF0YSB3aGVuIHRoZSB2aWV3IGlzIGNyZWF0ZWQgYW5kIHRoZSBkYXRhIGlzXHJcbiAgICAgICAgLy8gYWxyZWFkeSBiZWluZyBvYnNlcnZlZFxyXG4gICAgICAgIGlmKHRoaXMuJHBhcmVudC5Vc2VyLmlzTG9nZ2VkKVxyXG4gICAgICAgICAgICB0aGlzLmZldGNoRmF2cyh0cnVlKVxyXG5cclxuICAgICAgICB0aGlzLmZldGNoRGF0YSgpXHJcbiAgICB9LFxyXG4gICAgbWV0aG9kczoge1xyXG4gICAgICAgIGZldGNoRGF0YTogZnVuY3Rpb24oKXtcclxuICAgICAgICAgICAgdmFyIF90aGlzID0gdGhpcztcclxuICAgICAgICAgICAgYXBpLiRodHRwLmdldChhcGlSZXNvdXJjZXMubXVzaWNzKS50aGVuKGZ1bmN0aW9uIHN1Y2Nlc3ModHJhY2tzKXtcclxuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCd0cmFja3MgbG9hZGVkJyk7XHJcbiAgICAgICAgICAgICAgICBfdGhpcy50cmFja3MgPSB0cmFja3MuYm9keTtcclxuICAgICAgICAgICAgfSwgZnVuY3Rpb24gZXJyb3IocmVzcG9uc2Upe1xyXG4gICAgICAgICAgICAgICAgYXBwLnNob3dUb2FzdChcIkVycm9yOiBDYW4ndCBnZXQgbXVzaWNzIGxpc3RcIiwgJ2Vycm9yJylcclxuICAgICAgICAgICAgfSlcclxuXHJcblxyXG4gICAgICAgIH0sXHJcbiAgICAgICAgZmV0Y2hGYXZzOiBmdW5jdGlvbihpc0NyZWF0aW9uKXtcclxuICAgICAgICAgICAgdmFyIF90aGlzID0gdGhpcztcclxuICAgICAgICAgICAgX3RoaXMuJHBhcmVudC5Vc2VyLmdldEZhdm91cml0ZXMoKS50aGVuKGZ1bmN0aW9uIHN1Y2Nlc3MoZmF2cyl7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ2ZhdnMgbG9hZGVkJyk7XHJcbiAgICAgICAgICAgICAgICBpZighZmF2cykgcmV0dXJuO1xyXG5cclxuICAgICAgICAgICAgICAgIF90aGlzLmZhdm9yaXRlcyA9IGZhdnM7XHJcbiAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgICAgIGlmKGlzQ3JlYXRpb24pe1xyXG4gICAgICAgICAgICAgICAgICAgIF90aGlzLmZ2cyA9IFtdO1xyXG4gICAgICAgICAgICAgICAgICAgIF90aGlzLmZhdm9yaXRlcy5mb3JFYWNoKGZ1bmN0aW9uKGYpe1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBfdGhpcy5mdnMucHVzaChmLmlkKVxyXG4gICAgICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH0sXHJcbiAgICAgICAgYWRkVG9GYXZzOiBmdW5jdGlvbihtdXNpY0lkKXtcclxuICAgICAgICAgICAgdGhpcy4kcGFyZW50LlVzZXIuYWRkRmF2b3VyaXRlKG11c2ljSWQpLnRoZW4oZnVuY3Rpb24gc3VjY2VzcyhyZXNwb25zZSl7XHJcbiAgICAgICAgICAgICAgICBhcHAuc2hvd1RvYXN0KHJlc3BvbnNlLm1lc3NhZ2UsICdzdWNjZXNzJylcclxuICAgICAgICAgICAgfSwgZnVuY3Rpb24gZXJyb3IocmVzcG9uc2Upe1xyXG4gICAgICAgICAgICAgICAgYXBwLnNob3dUb2FzdChcIkVycm9yOiBBIHByb2JsZW0gaGFzIG9jY3VycmVkIHdoaWxlIGFkZGluZyB0byBmYXZvcml0ZXNcIiwgJ2Vycm9yJylcclxuICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgdGhpcy5mdnMucHVzaChtdXNpY0lkKVxyXG4gICAgICAgICAgICB0aGlzLmZldGNoRmF2cygpXHJcbiAgICAgICAgICAgIC8vdGhpcy5mZXRjaERhdGEoKVxyXG4gICAgICAgIH0sXHJcbiAgICAgICAgcmVtb3ZlRnJvbUZhdnM6IGZ1bmN0aW9uKG11c2ljSWQpe1xyXG4gICAgICAgICAgICB0aGlzLiRwYXJlbnQuVXNlci5yZW1vdmVGYXZvdXJpdGUobXVzaWNJZCkudGhlbihmdW5jdGlvbiBzdWNjZXNzKHJlc3BvbnNlKXtcclxuICAgICAgICAgICAgICAgIGFwcC5zaG93VG9hc3QocmVzcG9uc2UubWVzc2FnZSwgJ3N1Y2Nlc3MnKVxyXG4gICAgICAgICAgICB9LCBmdW5jdGlvbiBlcnJvcihyZXNwb25zZSl7XHJcbiAgICAgICAgICAgICAgICBhcHAuc2hvd1RvYXN0KFwiRXJyb3I6IEEgcHJvYmxlbSBoYXMgb2NjdXJyZWQgd2hpbGUgcmVtb3ZpbmcgZnJvbSBmYXZvcml0ZXNcIiwgJ2Vycm9yJylcclxuICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgdGhpcy5mdnMuc3BsaWNlKHRoaXMuZnZzLmluZGV4T2YobXVzaWNJZCksIDEpXHJcbiAgICAgICAgICAgIHRoaXMuZmV0Y2hGYXZzKClcclxuICAgICAgICB9LFxyXG4gICAgICAgIGlzRmF2b3JpdGU6IGZ1bmN0aW9uKG11c2ljSWQpe1xyXG4gICAgICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xyXG4gICAgICAgICAgICBpZighX3RoaXMuZmF2b3JpdGVzKSByZXR1cm4gX3RoaXMuZmV0Y2hGYXZzKHRydWUpO1xyXG5cclxuICAgICAgICAgICAgdmFyIGlzRmF2ID0gX3RoaXMuZmF2b3JpdGVzLmZpbmQoZnVuY3Rpb24oZmF2KXtcclxuICAgICAgICAgICAgICAgIGlmKGZhdi5pZCA9PSBtdXNpY0lkKSByZXR1cm4gdHJ1ZTtcclxuICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGlzRmF2O1xyXG5cclxuICAgICAgICB9XHJcbiAgICB9LFxyXG4gICAgY29tcHV0ZWQ6IHtcclxuICAgICAgICBpc1VzZXJMb2dnZWQ6IGZ1bmN0aW9uKCl7XHJcbiAgICAgICAgICAgIHJldHVybiB0aGlzLiRwYXJlbnQuVXNlci5pc0xvZ2dlZDtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbn1cclxuXHJcbnZhciBGYXZvcml0ZXNDb21wb25lbnQgPSB7XHJcbiAgICB0ZW1wbGF0ZTogJyN0cGwtdHJhY2tsaXN0JyxcclxuICAgIGRhdGE6IGZ1bmN0aW9uKCl7IHJldHVybiB7dHJhY2tzOiBudWxsLCBmdnM6W119IH0sXHJcbiAgICBjcmVhdGVkOiBmdW5jdGlvbigpe1xyXG4gICAgICAgIC8vIGZldGNoIHRoZSBkYXRhIHdoZW4gdGhlIHZpZXcgaXMgY3JlYXRlZCBhbmQgdGhlIGRhdGEgaXNcclxuICAgICAgICAvLyBhbHJlYWR5IGJlaW5nIG9ic2VydmVkXHJcbiAgICAgICAgdGhpcy5mZXRjaERhdGEodHJ1ZSlcclxuICAgIH0sXHJcbiAgICBtZXRob2RzOiB7XHJcbiAgICAgICAgZmV0Y2hEYXRhOiBmdW5jdGlvbihpc0NyZWF0aW9uKXtcclxuICAgICAgICAgICAgdmFyIF90aGlzID0gdGhpcztcclxuICAgICAgICAgICAgX3RoaXMuJHBhcmVudC5Vc2VyLmdldEZhdm91cml0ZXMoKS50aGVuKGZ1bmN0aW9uIHN1Y2Nlc3MocmVzcG9uc2Upe1xyXG4gICAgICAgICAgICAgICAgaWYoIXJlc3BvbnNlKSByZXR1cm47XHJcbiAgICAgICAgICAgICAgICBfdGhpcy50cmFja3MgPSByZXNwb25zZTtcclxuICAgICAgICAgICAgICAgIGlmKGlzQ3JlYXRpb24pe1xyXG4gICAgICAgICAgICAgICAgICAgIF90aGlzLmZ2cyA9IFtdO1xyXG4gICAgICAgICAgICAgICAgICAgIF90aGlzLnRyYWNrcy5mb3JFYWNoKGZ1bmN0aW9uKGYpe1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBfdGhpcy5mdnMucHVzaChmLmlkKVxyXG4gICAgICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0sIGZ1bmN0aW9uIGVycm9yKHJlc3BvbnNlKXtcclxuICAgICAgICAgICAgICAgIC8vVE9ETzogaGFuZGxlIGVycm9yXHJcbiAgICAgICAgICAgICAgICBhcHAuc2hvd1RvYXN0KFwiRXJyb3I6IENhbid0IGdldCBmYXZvcml0cyBsaXN0XCIsICdlcnJvcicpXHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH0sXHJcbiAgICAgICAgYWRkVG9GYXZzOiBmdW5jdGlvbihtdXNpY0lkKXtcclxuICAgICAgICAgICAgdGhpcy4kcGFyZW50LlVzZXIuYWRkRmF2b3VyaXRlKG11c2ljSWQpLnRoZW4oZnVuY3Rpb24gc3VjY2VzcyhyZXNwb25zZSl7XHJcbiAgICAgICAgICAgICAgICBhcHAuc2hvd1RvYXN0KHJlc3BvbnNlLm1lc3NhZ2UsICdzdWNjZXNzJylcclxuICAgICAgICAgICAgfSwgZnVuY3Rpb24gZXJyb3IocmVzcG9uc2Upe1xyXG4gICAgICAgICAgICAgICAgYXBwLnNob3dUb2FzdChyZXNwb25zZSwgJ2Vycm9yJylcclxuICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgdGhpcy5mdnMucHVzaChtdXNpY0lkKVxyXG4gICAgICAgICAgICB0aGlzLmZldGNoRGF0YSgpXHJcbiAgICAgICAgICAgIC8vdGhpcy5mZXRjaERhdGEoKVxyXG4gICAgICAgIH0sXHJcbiAgICAgICAgcmVtb3ZlRnJvbUZhdnM6IGZ1bmN0aW9uKG11c2ljSWQpe1xyXG4gICAgICAgICAgICB0aGlzLiRwYXJlbnQuVXNlci5yZW1vdmVGYXZvdXJpdGUobXVzaWNJZCkudGhlbihmdW5jdGlvbiBzdWNjZXNzKHJlc3BvbnNlKXtcclxuICAgICAgICAgICAgICAgIGFwcC5zaG93VG9hc3QocmVzcG9uc2UubWVzc2FnZSwgJ3N1Y2Nlc3MnKVxyXG4gICAgICAgICAgICB9LCBmdW5jdGlvbiBlcnJvcihyZXNwb25zZSl7XHJcbiAgICAgICAgICAgICAgICBhcHAuc2hvd1RvYXN0KFwiRXJyb3I6IEEgcHJvYmxlbSBoYXMgb2NjdXJyZWQgd2hpbGUgcmVtb3ZpbmcgZnJvbSBmYXZvcml0ZXNcIiwgJ2Vycm9yJylcclxuICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgdGhpcy5mdnMuc3BsaWNlKHRoaXMuZnZzLmluZGV4T2YobXVzaWNJZCksIDEpXHJcbiAgICAgICAgICAgIHRoaXMuZmV0Y2hEYXRhKClcclxuICAgICAgICB9LFxyXG4gICAgICAgIGlzRmF2b3JpdGU6IGZ1bmN0aW9uKG11c2ljSWQpe1xyXG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgICAgICB9LFxyXG4gICAgfSxcclxuICAgIGNvbXB1dGVkOiB7XHJcbiAgICAgICAgaXNVc2VyTG9nZ2VkOiBmdW5jdGlvbigpe1xyXG4gICAgICAgICAgICByZXR1cm4gdGhpcy4kcGFyZW50LlVzZXIuaXNMb2dnZWQ7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG59XHJcblxyXG52YXIgVHJhY2tEZXRhaWxzQ29tcG9uZW50ID0ge1xyXG4gICAgdGVtcGxhdGU6ICcjdHBsLXRyYWNrLWRldGFpbHMnLFxyXG4gICAgZGF0YTogZnVuY3Rpb24oKXsgcmV0dXJuIHt0cmFja2RldGFpbHM6IHt0cmFjazpudWxsLCBhcnRpc3Q6IG51bGwsIGFsYnVtOiBudWxsfX0gfSxcclxuICAgIGNyZWF0ZWQ6IGZ1bmN0aW9uKCl7XHJcbiAgICAgICAgLy8gZmV0Y2ggdGhlIGRhdGEgd2hlbiB0aGUgdmlldyBpcyBjcmVhdGVkIGFuZCB0aGUgZGF0YSBpc1xyXG4gICAgICAgIC8vIGFscmVhZHkgYmVpbmcgb2JzZXJ2ZWRcclxuICAgICAgICB0aGlzLmZldGNoRGF0YSgpXHJcbiAgICB9LFxyXG4gICAgbWV0aG9kczoge1xyXG4gICAgICAgIGZldGNoRGF0YTogZnVuY3Rpb24oKXtcclxuICAgICAgICAgICAgdmFyIF90aGlzID0gdGhpcztcclxuICAgICAgICAgICAgYXBpLiRodHRwLmdldChhcGlSZXNvdXJjZXMubXVzaWNEZXRhaWxzLnJlcGxhY2UoXCI6bXVzaWNJZFwiLCBfdGhpcy4kcm91dGUucGFyYW1zLm11c2ljSWQpKS50aGVuKGZ1bmN0aW9uIHN1Y2Nlc3MocmVzcG9uc2Upe1xyXG4gICAgICAgICAgICAgICAgX3RoaXMudHJhY2tkZXRhaWxzID0gcmVzcG9uc2UuYm9keVswXTtcclxuICAgICAgICAgICAgfSwgZnVuY3Rpb24gZXJyb3IocmVzcG9uc2Upe1xyXG4gICAgICAgICAgICAgICAgLy9UT0RPOiBoYW5kbGUgZXJyb3JcclxuICAgICAgICAgICAgICAgIGFwcC5zaG93VG9hc3QoXCJFcnJvcjogU29tZSBlcnJvciBvY2N1cnJlZCB3aGlsZSBmZXRjaGluZyBtdXNpYyBkZXRhaWxzXCIsICdlcnJvcicpXHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxufVxyXG5cclxuXHJcbi8vIDIuIERlZmluZSBzb21lIHJvdXRlc1xyXG4vLyBFYWNoIHJvdXRlIHNob3VsZCBtYXAgdG8gYSBjb21wb25lbnQuIFRoZSBcImNvbXBvbmVudFwiIGNhblxyXG4vLyBlaXRoZXIgYmUgYW4gYWN0dWFsIGNvbXBvbmVudCBjb25zdHJ1Y3RvciBjcmVhdGVkIHZpYVxyXG4vLyBWdWUuZXh0ZW5kKCksIG9yIGp1c3QgYSBjb21wb25lbnQgb3B0aW9ucyBvYmplY3QuXHJcbi8vIFdlJ2xsIHRhbGsgYWJvdXQgbmVzdGVkIHJvdXRlcyBsYXRlci5cclxudmFyIHJvdXRlcyA9IFtcclxuICAgIHsgcGF0aDogJy8nLCBjb21wb25lbnQ6IEhvbWVDb21wb25lbnQsIG5hbWU6ICdob21lJywgbWV0YToge3RpdGxlOiAnSG9tZSd9IH0sXHJcbiAgICB7IHBhdGg6ICcvdXNlcnMvOnVzZXJJZC9tdXNpY3MnLCBjb21wb25lbnQ6IEZhdm9yaXRlc0NvbXBvbmVudCwgbmFtZTogJ2Zhdm9yaXRlcycsIG1ldGE6IHt0aXRsZTogJ0Zhdm9yaXRlcyd9IH0sXHJcbiAgICB7IHBhdGg6ICcvbXVzaWNzLzptdXNpY0lkJywgY29tcG9uZW50OiBUcmFja0RldGFpbHNDb21wb25lbnQsIG5hbWU6ICdtdXNpYycsIG1ldGE6IHt0aXRsZTogJ011c2ljIERldGFpbCd9IH1cclxuXVxyXG5cclxuLy8gMy4gQ3JlYXRlIHRoZSByb3V0ZXIgaW5zdGFuY2UgYW5kIHBhc3MgdGhlIGByb3V0ZXNgIG9wdGlvblxyXG4vLyBZb3UgY2FuIHBhc3MgaW4gYWRkaXRpb25hbCBvcHRpb25zIGhlcmUsIGJ1dCBsZXQnc1xyXG4vLyBrZWVwIGl0IHNpbXBsZSBmb3Igbm93LlxyXG52YXIgcm91dGVyID0gbmV3IFZ1ZVJvdXRlcih7XHJcbiAgICBsaW5rQWN0aXZlQ2xhc3M6ICdhY3RpdmUnLFxyXG4gICAgcm91dGVzOiByb3V0ZXNcclxufSlcclxuXHJcbnJvdXRlci5iZWZvcmVFYWNoKGZ1bmN0aW9uKHRvLCBmcm9tLCBuZXh0KSB7XHJcbiAgICBpZighVXNlci5pc0xvZ2dlZCAmJiB0by5uYW1lID09PSAnZmF2b3JpdGVzJyl7XHJcbiAgICAgICAgbmV4dCh7IHBhdGg6ICcvJywgcmVwbGFjZTogdHJ1ZX0pXHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICAgIGRvY3VtZW50LnRpdGxlID0gXCJCZWF0MlJldm9sdXRpb24gfCBcIit0by5tZXRhLnRpdGxlXHJcbiAgICAgICAgbmV4dCgpXHJcbiAgICB9XHJcbn0pXHJcblxyXG5cclxuLy8gNC4gQ3JlYXRlIGFuZCBtb3VudCB0aGUgcm9vdCBpbnN0YW5jZS5cclxuLy8gTWFrZSBzdXJlIHRvIGluamVjdCB0aGUgcm91dGVyIHdpdGggdGhlIHJvdXRlciBvcHRpb24gdG8gbWFrZSB0aGVcclxuLy8gd2hvbGUgYXBwIHJvdXRlci1hd2FyZS5cclxudmFyIGFwcCA9IG5ldyBWdWUoe1xyXG4gICAgcm91dGVyOnJvdXRlcixcclxuICAgIGRhdGE6IHtcclxuICAgICAgICBVc2VyOiBVc2VyLFxyXG4gICAgXHRjdXJyZW50OlwibG9naW4tbGlua1wiLFxyXG4gICAgICAgIHRvYXN0OiB7IG1zZzpudWxsLCB0eXBlOm51bGwgfSxcclxuICAgICAgICBpc1RvYXN0QWN0aXZlOiBmYWxzZSxcclxuICAgICAgICBpc1NpZGVCYXJDb2xsYXBzZWQ6IHRydWVcclxuICAgICAgICAvL3N3aXRjaFRvSW5wdXQ6IGZ1bmN0aW9uKCl7Y29uc29sZS5sb2coJ2JsYScpfSAvL3RoaXMuc3dpdGNoVG9JbnB1dFxyXG4gICAgfSxcclxuICAgIG1ldGhvZHM6e1xyXG4gICAgXHRzd2l0Y2hUb0xpbms6ZnVuY3Rpb24oKXtcclxuICAgICAgICBcdHRoaXMuY3VycmVudCA9ICdsb2dpbi1saW5rJztcclxuICAgICAgICB9LFxyXG4gICAgICAgIHN3aXRjaFRvSW5wdXQ6ZnVuY3Rpb24gc3dpdGNoVG9JbnB1dCgpe1xyXG4gICAgICAgIFx0dGhpcy5jdXJyZW50ID0gJ2xvZ2luLWlucHV0J1xyXG4gICAgICAgIH0sXHJcbiAgICAgICAgc2hvd1RvYXN0OmZ1bmN0aW9uIHNob3dUb2FzdChtc2csIHR5cGUpe1xyXG4gICAgICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xyXG4gICAgICAgIFx0X3RoaXMudG9hc3QubXNnID0gbXNnO1xyXG4gICAgICAgIFx0X3RoaXMudG9hc3QudHlwZSA9IHR5cGU7XHJcbiAgICAgICAgICAgIF90aGlzLmlzVG9hc3RBY3RpdmUgPSB0cnVlO1xyXG4gICAgICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uKCl7XHJcbiAgICAgICAgICAgICAgICBfdGhpcy5pc1RvYXN0QWN0aXZlID0gZmFsc2U7XHJcbiAgICAgICAgICAgIH0sMzUwMClcclxuICAgICAgICB9LCAgXHJcbiAgICAgICAgdG9nZ2xlQ29sbGFwc2U6IGZ1bmN0aW9uKCl7XHJcbiAgICAgICAgICAgIHRoaXMuaXNTaWRlQmFyQ29sbGFwc2VkID0gIXRoaXMuaXNTaWRlQmFyQ29sbGFwc2VkO1xyXG4gICAgICAgIH0gICBcclxuICAgIH0sXHJcbiAgICBjb21wb25lbnRzOlsnbG9naW4tbGluaycsJ2xvZ2luLWlucHV0JywgJ3RvYXN0LWFsZXJ0JywgJ21lZGlhLXBsYXllciddLFxyXG59KS4kbW91bnQoJyNhcHAnKVxyXG4iXX0=
